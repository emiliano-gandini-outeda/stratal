{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DBWarden - Professional Database Migration System","text":"<p>DBWarden is a professional-grade database migration system designed specifically for Python projects using SQLAlchemy. It provides a robust, reliable, and developer-friendly approach to managing database schema changes across different environments.</p>"},{"location":"#what-is-dbwarden","title":"What is DBWarden?","text":"<p>DBWarden addresses the critical challenge of maintaining consistent database schemas across development, staging, and production environments. It combines the flexibility of SQL-based migrations with the convenience of automatic migration generation from SQLAlchemy models.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Automatic Migration Generation: Automatically generate SQL migrations from your SQLAlchemy models</li> <li>Version Control: Track all schema changes with detailed history and timestamps</li> <li>Rollback Support: Safely revert migrations when needed</li> <li>Multiple Database Support: Works with PostgreSQL, MySQL, and SQLite</li> <li>Async/Sync Modes: Support for both synchronous and asynchronous database operations</li> <li>Model Discovery: Automatically finds and processes your SQLAlchemy models</li> <li>Migration Locking: Prevents concurrent migration execution</li> <li>Schema Inspection: Inspect and compare database schemas</li> </ul>"},{"location":"#why-use-dbwarden","title":"Why Use DBWarden?","text":""},{"location":"#for-development-teams","title":"For Development Teams","text":"<ul> <li>Consistency: Ensure all developers work with the same database schema</li> <li>Automation: Reduce manual SQL writing with automatic migration generation</li> <li>Traceability: Maintain a complete history of all schema changes</li> <li>Safety: Built-in rollback capabilities for quick recovery</li> </ul>"},{"location":"#for-production-systems","title":"For Production Systems","text":"<ul> <li>Reliability: Robust migration execution with error handling</li> <li>Idempotency: Migrations can be run multiple times safely</li> <li>Version Targeting: Migrate to specific versions when needed</li> <li>Locking: Prevent race conditions during migration execution</li> </ul>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<p>DBWarden follows a modular architecture designed for reliability and extensibility:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     DBWarden CLI                         \u2502\n\u2502                    (Typer-based)                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Commands Layer                                         \u2502\n\u2502  \u251c\u2500\u2500 init         \u251c\u2500\u2500 migrate      \u251c\u2500\u2500 rollback         \u2502\n\u2502  \u251c\u2500\u2500 make-migrations \u251c\u2500\u2500 history    \u251c\u2500\u2500 status         \u2502\n\u2502  \u2514\u2500\u2500 ...          \u2514\u2500\u2500 ...           \u2514\u2500\u2500 ...             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Engine Layer                                          \u2502\n\u2502  \u251c\u2500\u2500 Model Discovery  \u251c\u2500\u2500 Versioning  \u251c\u2500\u2500 File Parser   \u2502\n\u2502  \u2514\u2500\u2500 Checksum         \u2514\u2500\u2500 Locking                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Repository Layer                                     \u2502\n\u2502  \u251c\u2500\u2500 Migration Records  \u251c\u2500\u2500 Lock Management             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Database Layer                                         \u2502\n\u2502  \u251c\u2500\u2500 Connection Pool  \u251c\u2500\u2500 SQL Execution                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># Initialize migrations directory\ndbwarden init\n\n# Generate migration from SQLAlchemy models\ndbwarden make-migrations \"create users table\"\n\n# Apply migrations\ndbwarden migrate --verbose\n\n# Check migration history\ndbwarden history\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Installation: Get started with installing DBWarden</li> <li>Configuration: Set up your environment</li> <li>Quick Start: Walk through a complete example</li> <li>Commands: Explore all available commands</li> <li>SQLAlchemy Models: Learn how to define models for migrations</li> </ul>"},{"location":"#license","title":"License","text":"<p>DBWarden is released under the MIT License.</p>"},{"location":"advanced/","title":"Advanced Features","text":"<p>This guide covers advanced DBWarden features and techniques for complex migration scenarios.</p>"},{"location":"advanced/#migration-locking","title":"Migration Locking","text":"<p>DBWarden uses a locking mechanism to prevent concurrent migration execution.</p>"},{"location":"advanced/#automatic-locking","title":"Automatic Locking","text":"<p>Locks are automatically acquired and released during: - <code>migrate</code> - <code>rollback</code></p>"},{"location":"advanced/#manual-lock-management","title":"Manual Lock Management","text":"<p>Check lock status:</p> <pre><code>dbwarden lock-status\n</code></pre> <p>Force unlock (emergency):</p> <pre><code>dbwarden unlock\n</code></pre>"},{"location":"advanced/#lock-implementation","title":"Lock Implementation","text":"<pre><code>-- strata_lock table\nCREATE TABLE strata_lock (\n    id INTEGER PRIMARY KEY,\n    locked BOOLEAN DEFAULT FALSE,\n    acquired_at DATETIME,\n    release_at DATETIME\n);\n</code></pre>"},{"location":"advanced/#checksum-validation","title":"Checksum Validation","text":"<p>DBWarden validates migration integrity using checksums.</p>"},{"location":"advanced/#how-it-works","title":"How It Works","text":"<ol> <li>Before execution: Calculate checksum of migration file</li> <li>After execution: Store checksum in database</li> <li>Future runs: Verify checksum matches stored value</li> </ol>"},{"location":"advanced/#checksum-algorithm","title":"Checksum Algorithm","text":"<p>Uses SHA-256 hash of SQL statements:</p> <pre><code>import hashlib\n\ndef calculate_checksum(sql_statements):\n    content = \"\".join(sql_statements)\n    return hashlib.sha256(content.encode()).hexdigest()\n</code></pre>"},{"location":"advanced/#validation","title":"Validation","text":"<p>On migration run:</p> <pre><code>stored_checksum = get_stored_checksum()\ncurrent_checksum = calculate_checksum(sql_statements)\n\nif stored_checksum != current_checksum:\n    raise MigrationChecksumError(\"Migration file has been modified!\")\n</code></pre>"},{"location":"advanced/#squash-migrations","title":"Squash Migrations","text":"<p>Combine multiple migrations into one.</p>"},{"location":"advanced/#when-to-squash","title":"When to Squash","text":"<ul> <li>After 10+ small migrations</li> <li>Before major releases</li> <li>During maintenance windows</li> </ul>"},{"location":"advanced/#process","title":"Process","text":"<pre><code># 1. Ensure all migrations applied\ndbwarden migrate\n\n# 2. Squash migrations\ndbwarden squash\n\n# 3. New migration created\nls migrations/\n# V20240215_143000__initial_schema.sql  (consolidated)\n</code></pre>"},{"location":"advanced/#beforeafter","title":"Before/After","text":"<p>Before:</p> <pre><code>V20240215_143000__create_users.sql\nV20240215_143001__add_email.sql\nV20240215_143002__add_username.sql\nV20240215_143003__add_password.sql\nV20240215_143004__add_bio.sql\n</code></pre> <p>After:</p> <pre><code>V20240215_143000__initial_schema.sql\n</code></pre>"},{"location":"advanced/#manual-squash","title":"Manual Squash","text":"<p>For more control:</p> <pre><code># 1. Create new migration\ndbwarden new \"consolidate user migrations\"\n\n# 2. Edit file, combine SQL from all migrations\n</code></pre>"},{"location":"advanced/#custom-model-paths","title":"Custom Model Paths","text":"<p>Configure multiple model directories.</p>"},{"location":"advanced/#configuration","title":"Configuration","text":"<pre><code>STRATA_MODEL_PATHS=models/,app/models/,core/database/models/\n</code></pre>"},{"location":"advanced/#priority","title":"Priority","text":"<p>Paths are processed in order: 1. First path's models processed first 2. Duplicate tables (same <code>__tablename__</code>) are skipped after first occurrence</p>"},{"location":"advanced/#postgresql-schema-support","title":"PostgreSQL Schema Support","text":""},{"location":"advanced/#configuration_1","title":"Configuration","text":"<pre><code>STRATA_POSTGRES_SCHEMA=my_schema\n</code></pre>"},{"location":"advanced/#usage","title":"Usage","text":"<p>All migrations run in specified schema:</p> <pre><code>CREATE TABLE my_schema.users (... Multiple Schemas\n\nFor multiple);\n</code></pre>"},{"location":"advanced/#schemas-use-fully-qualified-names-in-migrations","title":"schemas, use fully qualified names in migrations:","text":"<pre><code>-- upgrade\n\nCREATE TABLE analytics.events (\n    id SERIAL PRIMARY KEY,\n    name VARCHAR(200)\n);\n\nCREATE TABLE public.users (\n    id SERIAL PRIMARY KEY,\n    email VARCHAR(255)\n);\n\n-- rollback\n\nDROP TABLE public.users;\nDROP TABLE analytics.events;\n</code></pre>"},{"location":"advanced/#transactions-in-migrations","title":"Transactions in Migrations","text":""},{"location":"advanced/#basic-transaction","title":"Basic Transaction","text":"<pre><code>-- upgrade\n\nBEGIN;\n\nCREATE TABLE orders (\n    id SERIAL PRIMARY KEY,\n    total DECIMAL(10, 2)\n);\n\nCREATE TABLE order_items (\n    id SERIAL PRIMARY KEY,\n    order_id INTEGER REFERENCES orders(id)\n);\n\nCOMMIT;\n\n-- rollback\n\nBEGIN;\n\nDROP TABLE order_items;\nDROP TABLE orders;\n\nCOMMIT;\n</code></pre>"},{"location":"advanced/#complex-migration-pattern","title":"Complex Migration Pattern","text":"<pre><code>-- upgrade\n\n-- Step 1: Create new table with new structure\nCREATE TABLE posts_new (\n    id INTEGER PRIMARY KEY,\n    author_id INTEGER NOT NULL,\n    title VARCHAR(200) NOT NULL,\n    content TEXT,\n    slug VARCHAR(200) UNIQUE,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Step 2: Copy data with transformation\nINSERT INTO posts_new (id, author_id, title, content, slug, created_at)\nSELECT \n    id, \n    user_id, \n    title, \n    content, \n    LOWER(REPLACE(title, ' ', '-')),\n    created_at\nFROM posts;\n\n-- Step 3: Drop old table\nDROP TABLE posts;\n\n-- Step 4: Rename new table\nALTER TABLE posts_new RENAME TO posts;\n\n-- rollback\n\n-- Reverse all steps\nCREATE TABLE posts_old (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER NOT NULL,\n    title VARCHAR(200) NOT NULL,\n    content TEXT,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nINSERT INTO posts_old (id, user_id, title, content, created_at)\nSELECT id, author_id, title, content, created_at FROM posts;\n\nDROP TABLE posts;\n\nALTER TABLE posts_old RENAME TO posts;\n</code></pre>"},{"location":"advanced/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"advanced/#github-actions","title":"GitHub Actions","text":"<pre><code>name: Database Migrations\n\non:\n  push:\n    branches: [main]\n  workflow_dispatch:\n    inputs:\n      target:\n        description: 'Target version to migrate to'\n        required: false\n\njobs:\n  migrate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Set up Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install DBWarden\n        run: |\n          pip install dbwarden\n\n      - name: Run Migrations\n        run: |\n          if [ \"${{ github.event.inputs.target }}\" ]; then\n            dbwarden migrate --to-version ${{ github.event.inputs.target }}\n          else\n            dbwarden migrate --verbose\n          fi\n        env:\n          STRATA_SQLALCHEMY_URL: ${{ secrets.DATABASE_URL }}\n          STRATA_ASYNC: ${{ secrets.STRATA_ASYNC || 'false' }}\n</code></pre>"},{"location":"advanced/#gitlab-ci","title":"GitLab CI","text":"<pre><code>stages:\n  - migrate\n\nmigrate:\n  stage: migrate\n  image: python:3.11\n  script:\n    - pip install dbwarden\n    - dbwarden migrate --verbose\n  variables:\n    STRATA_SQLALCHEMY_URL: $DATABASE_URL\n  only:\n    - main\n</code></pre>"},{"location":"advanced/#docker-integration","title":"Docker Integration","text":"<pre><code>FROM python:3.11-slim\n\nWORKDIR /app\n\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY . .\n\nRUN pip install dbwarden\n\n# Run migrations on container start\nCMD [\"sh\", \"-c\", \"dbwarden migrate &amp;&amp; your_app\"]\n</code></pre>"},{"location":"advanced/#kubernetes","title":"Kubernetes","text":"<pre><code>apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: dbwarden-migrate\nspec:\n  template:\n    spec:\n      containers:\n      - name: migrate\n        image: your-app:latest\n        command: [\"dbwarden\", \"migrate\", \"--verbose\"]\n        env:\n        - name: STRATA_SQLALCHEMY_URL\n          valueFrom:\n            secretKeyRef:\n              name: db-credentials\n              key: url\n      restartPolicy: OnFailure\n</code></pre>"},{"location":"advanced/#environment-specific-migrations","title":"Environment-Specific Migrations","text":""},{"location":"advanced/#using-migration-tags","title":"Using Migration Tags","text":"<pre><code>-- V20240215_143000__base_schema.sql (always run)\n\n-- upgrade\nCREATE TABLE users (id INT PRIMARY KEY, email VARCHAR(255));\n-- rollback\nDROP TABLE users;\n</code></pre> <pre><code>-- V20240215_143001__demo_data.sql (demo only)\n\n-- upgrade\nINSERT INTO users (email) VALUES ('demo@example.com');\n-- rollback\nDELETE FROM users WHERE email = 'demo@example.com';\n</code></pre>"},{"location":"advanced/#programmatic-execution","title":"Programmatic Execution","text":"<pre><code>from dbwarden.config import get_config\nfrom dbwarden.commands.migrate import migrate_cmd\n\n# Apply migrations with target version\nmigrate_cmd(to_version=\"20240215_143000\", verbose=True)\n</code></pre>"},{"location":"advanced/#performance-optimization","title":"Performance Optimization","text":""},{"location":"advanced/#batch-migrations","title":"Batch Migrations","text":"<p>For many small migrations:</p> <pre><code># Apply all pending\ndbwarden migrate\n\n# Or apply specific number\ndbwarden migrate --count 10\n</code></pre>"},{"location":"advanced/#parallel-checks-future","title":"Parallel Checks (Future)","text":"<p>Currently migrations run sequentially for safety.</p>"},{"location":"advanced/#migration-recovery","title":"Migration Recovery","text":""},{"location":"advanced/#after-failed-migration","title":"After Failed Migration","text":"<ol> <li>Check lock status</li> <li>Unlock if necessary</li> <li>Verify database state</li> <li>Fix migration file</li> <li>Re-apply</li> </ol> <pre><code>dbwarden lock-status\ndbwarden unlock  # if locked\ndbwarden history\ndbwarden status\n# Fix migration file\ndbwarden migrate\n</code></pre>"},{"location":"advanced/#manual-state-correction","title":"Manual State Correction","text":"<p>In emergencies, manually update migration records:</p> <pre><code>-- Remove last migration record\nDELETE FROM strata_migrations \nWHERE version = '20240215_143000'\nORDER BY applied_at DESC \nLIMIT 1;\n</code></pre>"},{"location":"advanced/#best-practices-summary","title":"Best Practices Summary","text":"Practice Description Idempotent migrations Safe to run multiple times Include rollback Always have a rollback plan Test migrations On staging before production Backup first Especially in production Version control Commit migration files Review SQL Before applying Document complex migrations Comment your SQL Use transactions For multi-step changes"},{"location":"advanced/#common-patterns","title":"Common Patterns","text":""},{"location":"advanced/#pattern-1-safe-column-addition","title":"Pattern 1: Safe Column Addition","text":"<pre><code>-- upgrade\nALTER TABLE users ADD COLUMN bio TEXT;\nUPDATE users SET bio = '' WHERE bio IS NULL;\nALTER TABLE users ALTER COLUMN bio SET NOT NULL;\n\n-- rollback\nALTER TABLE users ALTER COLUMN bio DROP NOT NULL;\nALTER TABLE users DROP COLUMN bio;\n</code></pre>"},{"location":"advanced/#pattern-2-safe-data-migration","title":"Pattern 2: Safe Data Migration","text":"<pre><code>-- upgrade\nALTER TABLE users ADD COLUMN new_email VARCHAR(255);\n\nUPDATE users SET new_email = email;\n\n-- AFTER VERIFICATION:\n-- ALTER TABLE users DROP COLUMN email;\n-- ALTER TABLE users RENAME COLUMN new_email TO email;\n</code></pre>"},{"location":"advanced/#pattern-3-version-based-feature-flags","title":"Pattern 3: Version-Based Feature Flags","text":"<pre><code>-- upgrade\nCREATE TABLE feature_flags (\n    id SERIAL PRIMARY KEY,\n    name VARCHAR(100) UNIQUE,\n    enabled BOOLEAN DEFAULT FALSE\n);\n\nINSERT INTO feature_flags (name, enabled) VALUES ('new_checkout', FALSE);\n\n-- rollback\nDROP TABLE feature_flags;\n</code></pre>"},{"location":"advanced/#see-also","title":"See Also","text":"<ul> <li>Commands: All command reference</li> <li>Migration Files: Writing advanced migrations</li> <li>Models: Advanced model patterns</li> </ul>"},{"location":"cli-reference/","title":"CLI Reference","text":"<p>Complete command-line interface reference for DBWarden.</p>"},{"location":"cli-reference/#synopsis","title":"Synopsis","text":"<pre><code>dbwarden [OPTIONS] COMMAND [ARGS]...\n</code></pre>"},{"location":"cli-reference/#global-options","title":"Global Options","text":"Option Description <code>--help</code>, <code>-h</code> Show help message <code>--version</code> Show version information"},{"location":"cli-reference/#commands","title":"Commands","text":""},{"location":"cli-reference/#initialization","title":"Initialization","text":""},{"location":"cli-reference/#init","title":"init","text":"<p>Initialize the migrations directory.</p> <pre><code>dbwarden init\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#migration-management","title":"Migration Management","text":""},{"location":"cli-reference/#make-migrations","title":"make-migrations","text":"<p>Auto-generate SQL migration from SQLAlchemy models.</p> <pre><code>dbwarden make-migrations [DESCRIPTION] [OPTIONS]\n</code></pre> <p>Arguments: - <code>DESCRIPTION</code>: Description for the migration (optional)</p> <p>Options: - <code>--verbose</code>, <code>-v</code>: Enable verbose logging</p> <p>Examples:</p> <pre><code>dbwarden make-migrations \"create users table\"\ndbwarden make-migrations \"add posts\" --verbose\ndbwarden make-migrations\n</code></pre>"},{"location":"cli-reference/#new","title":"new","text":"<p>Create a new manual migration file.</p> <pre><code>dbwarden new DESCRIPTION [OPTIONS]\n</code></pre> <p>Arguments: - <code>DESCRIPTION</code>: Description of the migration (required)</p> <p>Options: - <code>--version</code>, `-v: Version of the migration</p> <p>Examples:</p> <pre><code>dbwarden new \"add index to users email\"\ndbwarden new \"custom migration\" --version 2.0.0\n</code></pre>"},{"location":"cli-reference/#migrate","title":"migrate","text":"<p>Apply pending migrations to the database.</p> <pre><code>dbwarden migrate [OPTIONS]\n</code></pre> <p>Options: - <code>--count</code>, <code>-c</code>: Number of migrations to apply - <code>--to-version</code>, <code>-t</code>: Migrate to a specific version - <code>--verbose</code>, <code>-v</code>: Enable verbose logging</p> <p>Examples:</p> <pre><code>dbwarden migrate\ndbwarden migrate --verbose\ndbwarden migrate --count 2\ndbwarden migrate --to-version 20240215_143000\n</code></pre>"},{"location":"cli-reference/#rollback","title":"rollback","text":"<p>Rollback the last applied migration.</p> <pre><code>dbwarden rollback [OPTIONS]\n</code></pre> <p>Options: - <code>--count</code>, <code>-c: Number of migrations to rollback -</code>--to-version<code>,</code>-t<code>: Rollback to a specific version -</code>--verbose<code>,</code>-v: Enable verbose logging</p> <p>Examples:</p> <pre><code>dbwarden rollback\ndbwarden rollback --count 2\ndbwarden rollback --to-version 20240215_143000\n</code></pre>"},{"location":"cli-reference/#squash","title":"squash","text":"<p>Merge multiple consecutive migrations into one.</p> <pre><code>dbwarden squash [OPTIONS]\n</code></pre> <p>Options: - <code>--verbose</code>, <code>-v</code>: Enable verbose logging</p> <p>Example:</p> <pre><code>dbwarden squash\n</code></pre>"},{"location":"cli-reference/#status-and-information","title":"Status and Information","text":""},{"location":"cli-reference/#history","title":"history","text":"<p>Show the full migration history.</p> <pre><code>dbwarden history\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#status","title":"status","text":"<p>Show migration status (applied and pending).</p> <pre><code>dbwarden status\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#mode","title":"mode","text":"<p>Display whether execution is sync or async.</p> <pre><code>dbwarden mode\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#version","title":"version","text":"<p>Display DBWarden version and compatibility information.</p> <pre><code>dbwarden version\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#env","title":"env","text":"<p>Display relevant environment variables without leaking secrets.</p> <pre><code>dbwarden env\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#database-inspection","title":"Database Inspection","text":""},{"location":"cli-reference/#check-db","title":"check-db","text":"<p>Inspect the live database schema.</p> <pre><code>dbwarden check-db [OPTIONS]\n</code></pre> <p>Options: - <code>--out</code>, `-o: Output format (json, yaml, txt)</p> <p>Examples:</p> <pre><code>dbwarden check-db\ndbwarden check-db --out json\ndbwarden check-db --out yaml\n</code></pre>"},{"location":"cli-reference/#diff","title":"diff","text":"<p>Show structural differences between models and database.</p> <pre><code>dbwarden diff [TYPE] [OPTIONS]\n</code></pre> <p>Arguments: - <code>TYPE</code>: Type of diff (models, migrations, all) - default: all</p> <p>Options: - <code>--verbose</code>, `-v: Enable verbose logging</p> <p>Examples:</p> <pre><code>dbwarden diff\ndbwarden diff --verbose\ndbwarden diff models\n</code></pre>"},{"location":"cli-reference/#lock-management","title":"Lock Management","text":""},{"location":"cli-reference/#lock-status","title":"lock-status","text":"<p>Check if migration is currently locked.</p> <pre><code>dbwarden lock-status\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#unlock","title":"unlock","text":"<p>Release the migration lock.</p> <pre><code>dbwarden unlock\n</code></pre> <p>No arguments or options.</p>"},{"location":"cli-reference/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 Success 1 General error 2 Configuration error 3 Migration error"},{"location":"cli-reference/#environment-variables","title":"Environment Variables","text":"Variable Required Description <code>STRATA_SQLALCHEMY_URL</code> Yes Database connection URL <code>STRATA_ASYNC</code> No Enable async mode (true/false) <code>STRATA_MODEL_PATHS</code> No Paths to SQLAlchemy models <code>STRATA_POSTGRES_SCHEMA</code> No PostgreSQL schema"},{"location":"cli-reference/#configuration-file","title":"Configuration File","text":"<p>DBWarden uses <code>.env</code> file for configuration:</p> <pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:pass@localhost:5432/db\nSTRATA_ASYNC=false\nSTRATA_MODEL_PATHS=models/\nSTRATA_POSTGRES_SCHEMA=public\n</code></pre>"},{"location":"cli-reference/#shortcuts","title":"Shortcuts","text":"<p>Some commands have shortcuts:</p> Command Shortcut <code>dbwarden --help</code> <code>dbwarden -h</code> <code>dbwarden --verbose</code> <code>dbwarden -v</code> <code>dbwarden --count</code> <code>dbwarden -c</code> <code>dbwarden --to-version</code> <code>dbwarden -t</code> <code>dbwarden --out</code> <code>dbwarden -o</code>"},{"location":"cli-reference/#tab-completion","title":"Tab Completion","text":"<p>Enable tab completion for bash:</p> <pre><code>eval \"$(dbwarden --print-completion bash)\"\n</code></pre> <p>For zsh:</p> <pre><code>eval \"$(dbwarden --print-completion zsh)\"\n</code></pre>"},{"location":"cli-reference/#logging-levels","title":"Logging Levels","text":"Level Description INFO General information WARNING Potential issues ERROR Errors DEBUG Detailed debugging (with --verbose)"},{"location":"cli-reference/#troubleshooting","title":"Troubleshooting","text":""},{"location":"cli-reference/#command-not-found","title":"Command Not Found","text":"<pre><code># Check installation\npip show dbwarden\n\n# Reinstall\npip install --upgrade dbwarden\n</code></pre>"},{"location":"cli-reference/#permission-denied","title":"Permission Denied","text":"<pre><code># Make sure scripts are executable\nchmod +x /path/to/dbwarden\n</code></pre>"},{"location":"cli-reference/#invalid-configuration","title":"Invalid Configuration","text":"<pre><code># Validate .env file\ndbwarden env\n\n# Check file exists\nls -la .env\n</code></pre>"},{"location":"cli-reference/#see-also","title":"See Also","text":"<ul> <li>Commands Overview: Command categories and usage patterns</li> <li>Configuration: Environment variable details</li> <li>Installation: Installation troubleshooting</li> </ul>"},{"location":"commands/","title":"Commands Overview","text":"<p>DBWarden provides a comprehensive set of commands for managing database migrations. This page provides an overview of all available commands.</p>"},{"location":"commands/#command-categories","title":"Command Categories","text":""},{"location":"commands/#initialization-commands","title":"Initialization Commands","text":"Command Description init Initialize the migrations directory"},{"location":"commands/#migration-management","title":"Migration Management","text":"Command Description make-migrations Auto-generate SQL migrations from SQLAlchemy models new Create a manual migration file migrate Apply pending migrations rollback Rollback applied migrations squash Merge multiple migrations into one"},{"location":"commands/#status-and-information","title":"Status and Information","text":"Command Description history Show migration history status Show migration status mode Display sync/async mode version Display DBWarden version env Display environment configuration"},{"location":"commands/#database-inspection","title":"Database Inspection","text":"Command Description check-db Inspect database schema diff Compare models vs database"},{"location":"commands/#lock-management","title":"Lock Management","text":"Command Description lock-status Check migration lock status unlock Release the migration lock"},{"location":"commands/#global-options","title":"Global Options","text":"<p>All commands support the following options:</p> Option Description <code>--help</code>, <code>-h</code> Show help message <code>--verbose</code>, <code>-v</code> Enable verbose logging"},{"location":"commands/#usage-patterns","title":"Usage Patterns","text":""},{"location":"commands/#apply-migrations","title":"Apply Migrations","text":"<pre><code># Apply all pending migrations\ndbwarden migrate\n\n# Apply with verbose output\ndbwarden migrate --verbose\n\n# Apply specific number of migrations\ndbwarden migrate --count 2\n\n# Migrate to a specific version\ndbwarden migrate --to-version 20240215_143000\n</code></pre>"},{"location":"commands/#generate-migrations","title":"Generate Migrations","text":"<pre><code># Generate from models with description\ndbwarden make-migrations \"create users table\"\n\n# Generate with verbose logging\ndbwarden make-migrations \"add posts table\" --verbose\n</code></pre>"},{"location":"commands/#rollback-migrations","title":"Rollback Migrations","text":"<pre><code># Rollback the last migration\ndbwarden rollback\n\n# Rollback 2 migrations\ndbwarden rollback --count 2\n\n# Rollback to specific version\ndbwarden rollback --to-version 20240215_143000\n</code></pre>"},{"location":"commands/#check-status","title":"Check Status","text":"<pre><code># View all migrations and their status\ndbwarden status\n\n# View migration history\ndbwarden history\n\n# Check database schema\ndbwarden check-db --out json\n</code></pre>"},{"location":"commands/#command-execution-flow","title":"Command Execution Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  dbwarden &lt;command&gt;                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. Load Configuration (.env)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. Validate Environment                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. Execute Command Logic                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  4. Display Results                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"commands/#error-handling","title":"Error Handling","text":"<p>DBWarden provides clear error messages for common issues:</p> <ul> <li>Missing .env file: \"STRATA_SQLALCHEMY_URL is required\"</li> <li>Migrations directory not found: \"Please run 'dbwarden init' first\"</li> <li>Pending migrations: \"Cannot generate migrations while X migrations are pending\"</li> <li>Lock active: \"Migration is currently locked\"</li> </ul>"},{"location":"commands/#output-formats","title":"Output Formats","text":"<p>Some commands support different output formats:</p> Command Formats <code>check-db</code> <code>txt</code> (default), <code>json</code>, <code>yaml</code> <p>Example:</p> <pre><code>dbwarden check-db --out json\ndbwarden check-db --out yaml\n</code></pre>"},{"location":"commands/#getting-help","title":"Getting Help","text":"<p>Get help for any command:</p> <pre><code># General help\ndbwarden --help\n\n# Command-specific help\ndbwarden migrate --help\ndbwarden make-migrations --help\n</code></pre>"},{"location":"configuration/","title":"Configuration","text":"<p>DBWarden is configured through environment variables stored in a <code>.env</code> file. This guide covers all configuration options.</p>"},{"location":"configuration/#environment-file","title":"Environment File","text":"<p>DBWarden looks for a <code>.env</code> file in the current working directory or any parent directory. This file must contain at minimum the database connection URL.</p>"},{"location":"configuration/#creating-the-env-file","title":"Creating the .env File","text":"<p>Create a <code>.env</code> file in your project root:</p> <pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:password@localhost:5432/mydb\n</code></pre>"},{"location":"configuration/#env-file-location","title":".env File Location","text":"<p>DBWarden searches for <code>.env</code> in the following order:</p> <ol> <li>Current working directory</li> <li>Parent directories (up to the filesystem root)</li> </ol> <p>This allows you to have a single <code>.env</code> file at your project root that applies to all subdirectories.</p>"},{"location":"configuration/#required-configuration","title":"Required Configuration","text":""},{"location":"configuration/#strata_sqlalchemy_url","title":"STRATA_SQLALCHEMY_URL","text":"<p>The SQLAlchemy database connection URL. This is the only required configuration variable.</p> <p>Format:</p> <pre><code>STRATA_SQLALCHEMY_URL=dialect+driver://username:password@host:port/database\n</code></pre> <p>Examples:</p> <pre><code># PostgreSQL\nSTRATA_SQLALCHEMY_URL=postgresql://user:password@localhost:5432/mydb\n\n# PostgreSQL with async\nSTRATA_SQLALCHEMY_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\n\n# MySQL\nSTRATA_SQLALCHEMY_URL=mysql://user:password@localhost:3306/mydb\n\n# SQLite\nSTRATA_SQLALCHEMY_URL=sqlite:///./mydb.db\n\n# SQLite in memory\nSTRATA_SQLALCHEMY_URL=sqlite:///:memory:\n</code></pre>"},{"location":"configuration/#optional-configuration","title":"Optional Configuration","text":""},{"location":"configuration/#strata_async","title":"STRATA_ASYNC","text":"<p>Enable or disable asynchronous database operations.</p> Value Mode <code>true</code>, <code>1</code>, <code>yes</code> Asynchronous <code>false</code>, <code>0</code>, <code>no</code> Synchronous (default) <p>Example:</p> <pre><code>STRATA_ASYNC=true\nSTRATA_SQLALCHEMY_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\n</code></pre>"},{"location":"configuration/#strata_model_paths","title":"STRATA_MODEL_PATHS","text":"<p>Comma-separated list of paths to directories containing SQLAlchemy models.</p> <p>Example:</p> <pre><code>STRATA_MODEL_PATHS=models/,app/models/,core/database/models/\n</code></pre> <p>If not specified, DBWarden will automatically look for <code>models/</code> or <code>model/</code> directories.</p>"},{"location":"configuration/#strata_postgres_schema","title":"STRATA_POSTGRES_SCHEMA","text":"<p>PostgreSQL schema to use (PostgreSQL only).</p> <p>Example:</p> <pre><code>STRATA_POSTGRES_SCHEMA=public\n</code></pre>"},{"location":"configuration/#complete-env-example","title":"Complete .env Example","text":"<pre><code># Database Connection\nSTRATA_SQLALCHEMY_URL=postgresql://myuser:mypassword@localhost:5432/myapp\nSTRATA_ASYNC=true\n\n# Model Discovery\nSTRATA_MODEL_PATHS=app/models/,models/\n\n# PostgreSQL Schema\nSTRATA_POSTGRES_SCHEMA=public\n</code></pre>"},{"location":"configuration/#configuration-in-different-environments","title":"Configuration in Different Environments","text":""},{"location":"configuration/#development-environment","title":"Development Environment","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://dev:dev123@localhost:5432/dev_db\nSTRATA_ASYNC=false\n</code></pre>"},{"location":"configuration/#staging-environment","title":"Staging Environment","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://staging:staging123@staging.example.com:5432/staging_db\nSTRATA_ASYNC=true\n</code></pre>"},{"location":"configuration/#production-environment","title":"Production Environment","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://prod:securepass@prod.example.com:5432/prod_db\nSTRATA_ASYNC=true\n</code></pre>"},{"location":"configuration/#configuration-validation","title":"Configuration Validation","text":"<p>Use the <code>dbwarden env</code> command to verify your configuration without exposing sensitive information:</p> <pre><code>dbwarden env\n</code></pre> <p>Output:</p> <pre><code>STRATA_SQLALCHEMY_URL: ***\nSTRATA_ASYNC: true\nSTRATA_MODEL_PATHS: models/\nSTRATA_POSTGRES_SCHEMA: public\n</code></pre>"},{"location":"configuration/#environment-variables-precedence","title":"Environment Variables Precedence","text":"<p>DBWarden checks environment variables in the following order:</p> <ol> <li>System environment variables (highest priority)</li> <li><code>.env</code> file in current directory</li> <li><code>.env</code> file in parent directories</li> </ol> <p>This means you can override <code>.env</code> file values with system environment variables if needed.</p>"},{"location":"configuration/#special-characters-in-passwords","title":"Special Characters in Passwords","text":"<p>If your database password contains special characters, URL-encode them:</p> <pre><code># Password: p@ss:word/123\nSTRATA_SQLALCHEMY_URL=postgresql://user:p%40ss%3Aword%2F123@localhost:5432/mydb\n</code></pre>"},{"location":"configuration/#troubleshooting-configuration","title":"Troubleshooting Configuration","text":""},{"location":"configuration/#missing-strata_sqlalchemy_url","title":"Missing STRATA_SQLALCHEMY_URL","text":"<pre><code>Error: STRATA_SQLALCHEMY_URL is required in .env file.\n</code></pre> <p>Make sure your <code>.env</code> file exists and contains the required variable.</p>"},{"location":"configuration/#invalid-url-format","title":"Invalid URL Format","text":"<pre><code>Error: Could not parse SQLAlchemy URL\n</code></pre> <p>Check that your URL follows the correct format: <code>dialect+driver://username:password@host:port/database</code></p>"},{"location":"configuration/#database-connection-failed","title":"Database Connection Failed","text":"<pre><code>Error: could not connect to server\n</code></pre> <p>Verify that: 1. The database server is running 2. The host and port are correct 3. The username and password are valid 4. The database exists</p>"},{"location":"configuration/#best-practices","title":"Best Practices","text":"<ol> <li>Never commit <code>.env</code> to version control: Add <code>.env</code> to your <code>.gitignore</code> file</li> <li>Use different configurations per environment: Create <code>.env.example</code> as a template</li> <li>Secure your credentials: Use secrets management in production</li> <li>Validate configuration: Run <code>dbwarden env</code> before applying migrations</li> </ol>"},{"location":"databases/","title":"Supported Databases","text":"<p>DBWarden supports multiple database backends. This guide covers configuration and considerations for each.</p>"},{"location":"databases/#overview","title":"Overview","text":"Database Sync Mode Async Mode Driver Required PostgreSQL Yes Yes <code>psycopg2-binary</code> (sync) / <code>asyncpg</code> (async) MySQL Yes No <code>mysql-connector-python</code> SQLite Yes Yes Built-in / <code>aiosqlite</code> (async)"},{"location":"databases/#postgresql","title":"PostgreSQL","text":""},{"location":"databases/#connection-url","title":"Connection URL","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:password@localhost:5432/mydb\n</code></pre>"},{"location":"databases/#sync-mode","title":"Sync Mode","text":"<pre><code>STRATA_ASYNC=false\nSTRATA_SQLALCHEMY_URL=postgresql://user:password@localhost:5432/mydb\n</code></pre> <p>Requirements:</p> <pre><code>pip install psycopg2-binary\n</code></pre>"},{"location":"databases/#async-mode","title":"Async Mode","text":"<pre><code>STRATA_ASYNC=true\nSTRATA_SQLALCHEMY_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\n</code></pre> <p>Requirements:</p> <pre><code>pip install asyncpg\n</code></pre>"},{"location":"databases/#features","title":"Features","text":"<ul> <li>Full support for all PostgreSQL features</li> <li>UUID types</li> <li>JSON/JSONB columns</li> <li>Array types (via manual migration)</li> <li>Full-text search (via manual migration)</li> <li>PostgreSQL-specific constraints</li> </ul>"},{"location":"databases/#postgresql-schema","title":"PostgreSQL Schema","text":"<p>Set default schema:</p> <pre><code>STRATA_POSTGRES_SCHEMA=public  # default\n# or\nSTRATA_POSTGRES_SCHEMA=custom_schema\n</code></pre>"},{"location":"databases/#example-postgresql-migration","title":"Example PostgreSQL Migration","text":"<pre><code>-- upgrade\n\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT uuid_ossp_generate_v4(),\n    email VARCHAR(255) NOT NULL UNIQUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_users_email ON users(email);\n\n-- rollback\n\nDROP INDEX idx_users_email;\nDROP TABLE users;\n</code></pre>"},{"location":"databases/#mysql","title":"MySQL","text":""},{"location":"databases/#connection-url_1","title":"Connection URL","text":"<pre><code>STRATA_SQLALCHEMY_URL=mysql://user:password@localhost:3306/mydb\n</code></pre>"},{"location":"databases/#sync-mode-only","title":"Sync Mode Only","text":"<p>MySQL does not support asynchronous connections in DBWarden.</p> <pre><code>STRATA_ASYNC=false\n</code></pre> <p>Requirements:</p> <pre><code>pip install mysql-connector-python\n</code></pre>"},{"location":"databases/#features_1","title":"Features","text":"<ul> <li>Full support for MySQL features</li> <li>ENUM types</li> <li>SET types</li> <li>Full-text indexes (MyISAM, InnoDB 5.6+)</li> <li>AUTO_INCREMENT</li> </ul>"},{"location":"databases/#limitations","title":"Limitations","text":"<ul> <li>No async mode</li> <li>Some PostgreSQL-specific types not available</li> <li>Different default string lengths</li> </ul>"},{"location":"databases/#example-mysql-migration","title":"Example MySQL Migration","text":"<pre><code>-- upgrade\n\nCREATE TABLE users (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    email VARCHAR(255) NOT NULL,\n    status ENUM('active', 'inactive', 'pending') DEFAULT 'active',\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE UNIQUE INDEX idx_users_email ON users(email);\n\n-- rollback\n\nDROP INDEX idx_users_email;\nDROP TABLE users;\n</code></pre>"},{"location":"databases/#sqlite","title":"SQLite","text":""},{"location":"databases/#connection-url_2","title":"Connection URL","text":"<pre><code># File-based\nSTRATA_SQLALCHEMY_URL=sqlite:///./mydb.db\n\n# In-memory\nSTRATA_SQLALCHEMY_URL=sqlite:///:memory:\n</code></pre>"},{"location":"databases/#sync-mode-default","title":"Sync Mode (Default)","text":"<pre><code>STRATA_ASYNC=false\n</code></pre> <p>No additional drivers needed.</p>"},{"location":"databases/#async-mode_1","title":"Async Mode","text":"<pre><code>STRATA_ASYNC=true\nSTRATA_SQLALCHEMY_URL=sqlite+aiosqlite:///./mydb.db\n</code></pre> <p>Requirements:</p> <pre><code>pip install aiosqlite\n</code></pre>"},{"location":"databases/#features_2","title":"Features","text":"<ul> <li>Simple file-based database</li> <li>Zero configuration</li> <li>Good for development/testing</li> <li>Full SQLite feature support</li> </ul>"},{"location":"databases/#limitations_1","title":"Limitations","text":"<ul> <li>No concurrent connections (file-based)</li> <li>Limited ALTER TABLE support</li> <li>Different type system (type affinity)</li> </ul>"},{"location":"databases/#example-sqlite-migration","title":"Example SQLite Migration","text":"<pre><code>-- upgrade\n\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    username TEXT NOT NULL UNIQUE,\n    email TEXT NOT NULL UNIQUE,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- rollback\n\nDROP TABLE users;\n</code></pre>"},{"location":"databases/#connection-pooling","title":"Connection Pooling","text":""},{"location":"databases/#sync-mode_1","title":"Sync Mode","text":"<p>SQLAlchemy creates an engine with connection pool:</p> <pre><code>from sqlalchemy import create_engine\nengine = create_engine(url, pool_size=5, max_overflow=10)\n</code></pre>"},{"location":"databases/#async-mode_2","title":"Async Mode","text":"<p>Async connection handling:</p> <pre><code>from sqlalchemy.ext.asyncio import AsyncSession\nfrom sqlalchemy.ext.asyncio import create_async_engine\n</code></pre>"},{"location":"databases/#ssltls-connections","title":"SSL/TLS Connections","text":""},{"location":"databases/#postgresql-with-ssl","title":"PostgreSQL with SSL","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:password@host:5432/db?sslmode=require\n</code></pre>"},{"location":"databases/#mysql-with-ssl","title":"MySQL with SSL","text":"<pre><code>STRATA_SQLALCHEMY_URL=mysql://user:password@host:3306/db?ssl=true\n</code></pre>"},{"location":"databases/#connection-strings-reference","title":"Connection Strings Reference","text":""},{"location":"databases/#postgresql_1","title":"PostgreSQL","text":"<pre><code>postgresql://user:pass@localhost:5432/mydb\npostgresql+asyncpg://user:pass@localhost:5432/mydb\npostgresql://user:pass@host:5432/mydb?sslmode=require\npostgresql://user:pass@host:5432/mydb?channel_binding=require\n</code></pre>"},{"location":"databases/#mysql_1","title":"MySQL","text":"<pre><code>mysql://user:pass@localhost:3306/mydb\nmysql+pymysql://user:pass@localhost:3306/mydb\nmysql+mysqlconnector://user:pass@localhost:3306/mydb\n</code></pre>"},{"location":"databases/#sqlite_1","title":"SQLite","text":"<pre><code>sqlite:///./mydb.db           # Relative path\nsqlite:////absolute/path.db   # Absolute path\nsqlite:///:memory:            # In-memory\nsqlite+aiosqlite:///./mydb.db # Async\n</code></pre>"},{"location":"databases/#database-specific-sql","title":"Database-Specific SQL","text":""},{"location":"databases/#postgresql_2","title":"PostgreSQL","text":"<pre><code>-- Create UUID extension\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n-- Use current timestamp with timezone\ncreated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n</code></pre>"},{"location":"databases/#mysql_2","title":"MySQL","text":"<pre><code>-- AUTO_INCREMENT\nid INT AUTO_INCREMENT PRIMARY KEY\n\n-- ENUM type\nstatus ENUM('active', 'inactive')\n</code></pre>"},{"location":"databases/#sqlite_2","title":"SQLite","text":"<pre><code>-- AUTOINCREMENT\nid INTEGER PRIMARY KEY AUTOINCREMENT\n\n-- No boolean, use integer\nis_active INTEGER DEFAULT 1\n</code></pre>"},{"location":"databases/#testing-different-databases","title":"Testing Different Databases","text":""},{"location":"databases/#development-sqlite","title":"Development (SQLite)","text":"<pre><code>STRATA_SQLALCHEMY_URL=sqlite:///./dev.db\nSTRATA_ASYNC=false\n</code></pre>"},{"location":"databases/#staging-postgresql","title":"Staging (PostgreSQL)","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:pass@staging.example.com:5432/staging_db\nSTRATA_ASYNC=true\n</code></pre>"},{"location":"databases/#production-postgresql","title":"Production (PostgreSQL)","text":"<pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:pass@prod.example.com:5432/prod_db\nSTRATA_ASYNC=true\n</code></pre>"},{"location":"databases/#best-practices","title":"Best Practices","text":""},{"location":"databases/#1-match-development-and-production","title":"1. Match Development and Production","text":"<p>Use same database in development as production when possible.</p>"},{"location":"databases/#2-test-migrations-on-all-databases","title":"2. Test Migrations on All Databases","text":"<p>If supporting multiple databases: 1. Test PostgreSQL migrations on PostgreSQL 2. Test MySQL migrations on MySQL 3. Test SQLite migrations on SQLite</p>"},{"location":"databases/#3-use-database-agnostic-types","title":"3. Use Database-Agnostic Types","text":"<pre><code># GOOD: Database-agnostic\nfrom sqlalchemy import Integer, String, DateTime\n\n# LESS PORTABLE: Database-specific\nfrom sqlalchemy.dialects.postgresql import UUID\n</code></pre>"},{"location":"databases/#4-handle-edge-cases","title":"4. Handle Edge Cases","text":"<pre><code>-- PostgreSQL: Create extension if not exists\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n-- MySQL: Safe drop\nDROP TABLE IF EXISTS users;\n\n-- SQLite: Limited ALTER TABLE\n-- Use CREATE TABLE + COPY + DROP pattern\n</code></pre>"},{"location":"databases/#troubleshooting","title":"Troubleshooting","text":""},{"location":"databases/#connection-refused","title":"Connection Refused","text":"<ol> <li>Check database is running</li> <li>Verify host and port</li> <li>Check credentials</li> <li>Test with direct client:</li> </ol> <pre><code>psql $DATABASE_URL\nmysql -u $USER -p $DATABASE\n</code></pre>"},{"location":"databases/#driver-not-found","title":"Driver Not Found","text":"<pre><code># PostgreSQL sync\npip install psycopg2-binary\n\n# PostgreSQL async\npip install asyncpg\n\n# MySQL\npip install mysql-connector-python\n\n# SQLite async\npip install aiosqlite\n</code></pre>"},{"location":"databases/#ssltls-errors","title":"SSL/TLS Errors","text":"<ol> <li>Check SSL mode in connection string</li> <li>Verify SSL certificates</li> <li>Try <code>sslmode=prefer</code> for testing</li> </ol>"},{"location":"databases/#see-also","title":"See Also","text":"<ul> <li>Configuration: Environment variables</li> <li>Migration Files: Writing database-specific SQL</li> <li>Models: Defining models for each database</li> </ul>"},{"location":"installation/","title":"Installation","text":"<p>This guide covers all aspects of installing DBWarden, from basic installation to advanced configurations.</p>"},{"location":"installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10 or higher</li> <li>pip or poetry for package management</li> <li>Access to a target database (PostgreSQL, MySQL, or SQLite)</li> </ul>"},{"location":"installation/#basic-installation","title":"Basic Installation","text":""},{"location":"installation/#using-pip","title":"Using pip","text":"<pre><code>pip install dbwarden\n</code></pre>"},{"location":"installation/#using-poetry","title":"Using poetry","text":"<pre><code>poetry add dbwarden\n</code></pre>"},{"location":"installation/#database-specific-installations","title":"Database-Specific Installations","text":"<p>DBWarden supports multiple databases. Install the dependencies for your specific database:</p>"},{"location":"installation/#postgresql-synchronous","title":"PostgreSQL (Synchronous)","text":"<pre><code>pip install dbwarden psycopg2-binary\n</code></pre>"},{"location":"installation/#postgresql-asynchronous","title":"PostgreSQL (Asynchronous)","text":"<pre><code>pip install dbwarden asyncpg\n</code></pre>"},{"location":"installation/#mysql-synchronous","title":"MySQL (Synchronous)","text":"<pre><code>pip install dbwarden mysql-connector-python\n</code></pre>"},{"location":"installation/#sqlite-synchronous","title":"SQLite (Synchronous)","text":"<p>SQLite support is included by default with SQLAlchemy.</p>"},{"location":"installation/#sqlite-asynchronous","title":"SQLite (Asynchronous)","text":"<pre><code>pip install dbwarden aiosqlite\n</code></pre>"},{"location":"installation/#complete-development-installation","title":"Complete Development Installation","text":"<p>Install all dependencies including development tools:</p> <pre><code>pip install dbwarden[dev]\n</code></pre> <p>Or with poetry:</p> <pre><code>poetry add --group dev dbwarden\n</code></pre>"},{"location":"installation/#verifying-installation","title":"Verifying Installation","text":"<p>Verify that DBWarden is installed correctly:</p> <pre><code>dbwarden --version\n</code></pre> <p>You should see output similar to:</p> <pre><code>DBWarden version: 1.0.0\nPython version: 3.12.0\nSQLAlchemy version: 2.0.10\n</code></pre>"},{"location":"installation/#installation-from-source","title":"Installation from Source","text":"<p>For development or to get the latest features:</p> <pre><code>git clone https://github.com/yourusername/dbwarden.git\ncd dbwarden\npip install -e .\n</code></pre>"},{"location":"installation/#virtual-environment-setup","title":"Virtual Environment Setup","text":"<p>It is recommended to install DBWarden in a virtual environment:</p>"},{"location":"installation/#using-venv","title":"Using venv","text":"<pre><code>python -m venv venv\nsource venv/bin/activate  # Linux/macOS\n# or\n.\\venv\\Scripts\\activate  # Windows\npip install dbwarden\n</code></pre>"},{"location":"installation/#using-poetry_1","title":"Using poetry","text":"<pre><code>poetry install\npoetry shell\n</code></pre>"},{"location":"installation/#docker-integration","title":"Docker Integration","text":"<p>DBWarden can be used within Docker containers:</p> <pre><code>FROM python:3.12-slim\n\nWORKDIR /app\n\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY . .\n\nRUN pip install dbwarden\n\nCMD [\"dbwarden\", \"--help\"]\n</code></pre>"},{"location":"installation/#docker-compose-example","title":"Docker Compose Example","text":"<pre><code>version: '3.8'\n\nservices:\n  app:\n    build: .\n    env_file:\n      - .env\n    volumes:\n      - .:/app\n    depends_on:\n      - db\n\n  db:\n    image: postgres:15\n    environment:\n      POSTGRES_DB: myapp\n      POSTGRES_USER: user\n      POSTGRES_PASSWORD: password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n</code></pre>"},{"location":"installation/#system-requirements","title":"System Requirements","text":"Component Minimum Recommended Python 3.10 3.11+ RAM 512 MB 1 GB+ Disk 100 MB 500 MB+ Database PostgreSQL 12+ PostgreSQL 15+"},{"location":"installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"installation/#command-not-found","title":"Command Not Found","text":"<p>If <code>dbwarden</code> command is not found after installation:</p> <ol> <li>Ensure your virtual environment is activated</li> <li>Check if pip installed the package correctly:</li> </ol> <pre><code>pip show dbwarden\n</code></pre> <ol> <li>Add the Python scripts directory to your PATH:</li> </ol> <pre><code># Linux/macOS\nexport PATH=\"$HOME/.local/bin:$PATH\"\n\n# Windows\nsetx PATH \"%PATH%;%APPDATA%\\Python\\PythonXX\\Scripts\"\n</code></pre>"},{"location":"installation/#import-errors","title":"Import Errors","text":"<p>If you encounter import errors:</p> <pre><code>pip install --upgrade pip\npip install --upgrade dbwarden\n</code></pre>"},{"location":"installation/#database-driver-issues","title":"Database Driver Issues","text":"<p>Ensure you have the correct database driver installed:</p> <pre><code># PostgreSQL\npip install psycopg2-binary\n\n# MySQL\npip install mysql-connector-python\n\n# SQLite (included)\n# No additional driver needed\n</code></pre>"},{"location":"installation/#upgrading","title":"Upgrading","text":"<p>To upgrade DBWarden to the latest version:</p> <pre><code>pip install --upgrade dbwarden\n</code></pre> <p>Or with poetry:</p> <pre><code>poetry update dbwarden\n</code></pre>"},{"location":"installation/#migration-between-versions","title":"Migration Between Versions","text":"<p>When upgrading DBWarden, check the changelog for any breaking changes that might affect your migration workflow.</p>"},{"location":"migration-files/","title":"Migration Files","text":"<p>Migration files are the heart of DBWarden. They contain SQL statements that modify your database schema.</p>"},{"location":"migration-files/#file-structure","title":"File Structure","text":""},{"location":"migration-files/#naming-convention","title":"Naming Convention","text":"<p>Migration files follow this naming pattern:</p> <pre><code>V{version}__{description}.sql\n</code></pre> <p>Components: - <code>V</code>: Prefix indicating versioned migration - <code>{version}</code>: Version identifier (timestamp or semantic version) - <code>{description}</code>: Lowercase, underscore-separated description</p> <p>Examples:</p> <pre><code>V20240215_143000__create_users_table.sql\nV1.0.0__initial_schema.sql\nV20240215_143002__add_user_posts_relationship.sql\n</code></pre>"},{"location":"migration-files/#internal-structure","title":"Internal Structure","text":"<p>Each migration file has two sections:</p> <pre><code>-- upgrade\n\n-- Your upgrade SQL statements here\n\n-- rollback\n\n-- Your rollback SQL statements here\n</code></pre>"},{"location":"migration-files/#example-migrations","title":"Example Migrations","text":""},{"location":"migration-files/#create-table","title":"Create Table","text":"<pre><code>-- migrations/V20240215_143000__create_users.sql\n\n-- upgrade\n\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE INDEX idx_users_email ON users(email);\n\n-- rollback\n\nDROP INDEX idx_users_email;\nDROP TABLE users;\n</code></pre>"},{"location":"migration-files/#add-column","title":"Add Column","text":"<pre><code>-- migrations/V20240215_143001__add_user_profile.sql\n\n-- upgrade\n\nALTER TABLE users ADD COLUMN bio TEXT;\nALTER TABLE users ADD COLUMN avatar_url VARCHAR(500);\n\n-- rollback\n\nALTER TABLE users DROP COLUMN avatar_url;\nALTER TABLE users DROP COLUMN bio;\n</code></pre>"},{"location":"migration-files/#complex-migration-with-transactions","title":"Complex Migration with Transactions","text":"<pre><code>-- migrations/V20240215_143002__migrate_to_new_schema.sql\n\n-- upgrade\n\nBEGIN;\n\n-- Create new table\nCREATE TABLE posts_new (\n    id INTEGER PRIMARY KEY,\n    author_id INTEGER NOT NULL,\n    title VARCHAR(200) NOT NULL,\n    content TEXT,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Copy data\nINSERT INTO posts_new (id, author_id, title, content, created_at)\nSELECT id, user_id, title, content, created_at FROM posts;\n\n-- Drop old table\nDROP TABLE posts;\n\n-- Rename new table\nALTER TABLE posts_new RENAME TO posts;\n\nCOMMIT;\n\n-- rollback\n\nBEGIN;\n\n-- Reverse the migration\nCREATE TABLE posts_old (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER NOT NULL,\n    title VARCHAR(200) NOT NULL,\n    content TEXT,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\nINSERT INTO posts_old (id, user_id, title, content, created_at)\nSELECT id, author_id, title, content, created_at FROM posts;\n\nDROP TABLE posts;\n\nALTER TABLE posts_old RENAME TO posts;\n\nCOMMIT;\n</code></pre>"},{"location":"migration-files/#sql-support","title":"SQL Support","text":""},{"location":"migration-files/#supported-sql-statements","title":"Supported SQL Statements","text":"<ul> <li><code>CREATE TABLE</code></li> <li><code>ALTER TABLE ADD/DROP/MODIFY COLUMN</code></li> <li><code>DROP TABLE</code></li> <li><code>CREATE INDEX</code></li> <li><code>DROP INDEX</code></li> <li><code>CREATE/DROP VIEW</code></li> <li><code>CREATE/DROP TRIGGER</code></li> <li><code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> (for data migration)</li> <li><code>BEGIN</code>, <code>COMMIT</code>, <code>ROLLBACK</code> (transactions)</li> </ul>"},{"location":"migration-files/#database-specific-sql","title":"Database-Specific SQL","text":"<p>DBWarden supports database-specific SQL:</p> <pre><code>-- PostgreSQL\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n-- MySQL\nALTER TABLE users ENGINE=InnoDB;\n\n-- SQLite\nPRAGMA foreign_keys = ON;\n</code></pre>"},{"location":"migration-files/#version-management","title":"Version Management","text":""},{"location":"migration-files/#version-formats","title":"Version Formats","text":"<p>Timestamp (Recommended):</p> <pre><code>V20240215_143000__description.sql\n</code></pre> <ul> <li>Unique: Based on creation time</li> <li>Ordered: Naturally sorted chronologically</li> <li>Automatic: Generated by <code>make-migrations</code></li> </ul> <p>Semantic Version:</p> <pre><code>V1.0.0__description.sql\n</code></pre> <ul> <li>Manual: Set with <code>--version</code></li> <li>Explicit: You control versioning</li> <li>Used in: Release workflows</li> </ul>"},{"location":"migration-files/#version-ordering","title":"Version Ordering","text":"<p>DBWarden sorts versions: - Numeric segments compared first - Allows: <code>1.0.0</code>, <code>1.0.1</code>, <code>1.1.0</code>, <code>2.0.0</code></p>"},{"location":"migration-files/#best-practices","title":"Best Practices","text":""},{"location":"migration-files/#1-one-migration-per-feature","title":"1. One Migration Per Feature","text":"<pre><code>GOOD:\n\u251c\u2500\u2500 V20240215_143000__create_users.sql\n\u251c\u2500\u2500 V20240215_143001__create_posts.sql\n\u2514\u2500\u2500 V20240215_143002__add_comments.sql\n\nBAD:\n\u2514\u2500\u2500 V20240215_143000__users_posts_comments_all.sql\n</code></pre>"},{"location":"migration-files/#2-descriptive-names","title":"2. Descriptive Names","text":"<pre><code>GOOD: V20240215_143000__add_user_email_verification.sql\nBAD:  V20240215_143000__changes.sql\n</code></pre>"},{"location":"migration-files/#3-always-include-rollback","title":"3. Always Include Rollback","text":"<pre><code>-- GOOD: Has rollback\n-- upgrade\nCREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(100));\n-- rollback\nDROP TABLE users;\n\n-- BAD: No rollback\n-- upgrade\nCREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(100));\n</code></pre>"},{"location":"migration-files/#4-idempotent-migrations","title":"4. Idempotent Migrations","text":"<pre><code>-- GOOD: Idempotent\nCREATE TABLE IF NOT EXISTS users (id INT PRIMARY KEY);\n\n-- GOOD: Safe to run twice\nDROP INDEX IF EXISTS idx_users_email;\nCREATE INDEX idx_users_email ON users(email);\n</code></pre>"},{"location":"migration-files/#5-use-transactions-for-complex-changes","title":"5. Use Transactions for Complex Changes","text":"<pre><code>-- Wrap in transaction for atomicity\nBEGIN;\n-- All changes\nCOMMIT;\n</code></pre>"},{"location":"migration-files/#migration-lifecycle","title":"Migration Lifecycle","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 New File    \u2502 Created by make-migrations or new\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pending     \u2502 Not yet applied\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Applied     \u2502 migrate command executed\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Recorded    \u2502 Added to strata_migrations table\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"migration-files/#directory-structure","title":"Directory Structure","text":"<pre><code>project/\n\u251c\u2500\u2500 migrations/\n\u2502   \u251c\u2500\u2500 V20240215_143000__initial_schema.sql\n\u2502   \u251c\u2500\u2500 V20240215_143001__create_users.sql\n\u2502   \u251c\u2500\u2500 V20240215_143002__create_posts.sql\n\u2502   \u2514\u2500\u2500 .gitkeep          # Keep directory in git\n\u251c\u2500\u2500 models/\n\u2502   \u2514\u2500\u2500 user.py\n\u251c\u2500\u2500 .env\n\u2514\u2500\u2500 pyproject.toml\n</code></pre>"},{"location":"migration-files/#git-integration","title":"Git Integration","text":""},{"location":"migration-files/#add-to-version-control","title":"Add to Version Control","text":"<pre><code>git add migrations/\ngit commit -m \"Add database migrations\"\n</code></pre>"},{"location":"migration-files/#migration-file-rules","title":"Migration File Rules","text":"<ol> <li>Never modify applied migrations</li> <li>Always create new migrations for changes</li> <li>Review migration SQL before applying</li> </ol>"},{"location":"migration-files/#handling-migration-conflicts","title":"Handling Migration Conflicts","text":"<p>When merging branches:</p> <ol> <li>Review both migration sequences</li> <li>Combine if needed (or use squash)</li> <li>Ensure order is preserved</li> <li>Test after merge</li> </ol>"},{"location":"migration-files/#troubleshooting","title":"Troubleshooting","text":""},{"location":"migration-files/#migration-not-found","title":"Migration Not Found","text":"<p>Check file naming:</p> <pre><code>WRONG: 20240215_143000__desc.sql    (missing V)\nWRONG: V_desc.sql                    (missing version)\nRIGHT: V20240215_143000__desc.sql\n</code></pre>"},{"location":"migration-files/#parsing-errors","title":"Parsing Errors","text":"<p>Ensure proper section markers:</p> <pre><code>-- upgrade         (lowercase, no extra spaces)\n-- rollback        (lowercase)\n</code></pre>"},{"location":"migration-files/#duplicate-versions","title":"Duplicate Versions","text":"<p>Use unique versions:</p> <pre><code>ERROR: V1.0.0__feature.sql already exists\nFIX: Use V1.0.1__feature.sql or timestamp version\n</code></pre>"},{"location":"migration-files/#see-also","title":"See Also","text":"<ul> <li>make-migrations: Auto-generate migrations</li> <li>new: Create manual migrations</li> <li>migrate: Apply migrations</li> <li>rollback: Revert migrations</li> </ul>"},{"location":"models/","title":"SQLAlchemy Models","text":"<p>DBWarden automatically generates migrations from SQLAlchemy models. This guide covers how to define models that work best with DBWarden.</p>"},{"location":"models/#model-requirements","title":"Model Requirements","text":""},{"location":"models/#basic-structure","title":"Basic Structure","text":"<p>Your models must:</p> <ol> <li>Inherit from <code>declarative_base</code>: Use SQLAlchemy's declarative system</li> <li>Define <code>__tablename__</code>: Each model must have a table name</li> <li>Use SQLAlchemy types: Column types must be from SQLAlchemy</li> </ol> <pre><code>from sqlalchemy import Column, Integer, String\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True)\n    username = Column(String(50))\n</code></pre>"},{"location":"models/#supported-column-types","title":"Supported Column Types","text":"SQLAlchemy Type Description Generated SQL <code>Integer</code> Integer value <code>INTEGER</code> <code>String(n)</code> Variable-length string <code>VARCHAR(n)</code> <code>Text</code> Long text <code>TEXT</code> <code>Boolean</code> True/False <code>BOOLEAN</code> <code>DateTime</code> Date and time <code>DATETIME</code> <code>Date</code> Date only <code>DATE</code> <code>Time</code> Time only <code>TIME</code> <code>Float</code> Floating point <code>FLOAT</code> <code>Numeric(p, s)</code> Fixed precision <code>NUMERIC(p, s)</code> <code>JSON</code> JSON data <code>JSON</code> <code>LargeBinary</code> Binary data <code>BLOB</code> <code>Binary</code> Binary data <code>VARBINARY</code>"},{"location":"models/#column-options","title":"Column Options","text":""},{"location":"models/#primary-key","title":"Primary Key","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True)\n    # or with auto-increment\n    id = Column(Integer, primary_key=True, autoincrement=True)\n</code></pre>"},{"location":"models/#nullable","title":"Nullable","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n\n    email = Column(String(255), nullable=False)  # NOT NULL\n    bio = Column(Text, nullable=True)           # NULL (default)\n</code></pre>"},{"location":"models/#default-values","title":"Default Values","text":"<pre><code>from datetime import datetime\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    created_at = Column(DateTime, default=datetime.utcnow)\n    is_active = Column(Boolean, default=True)\n</code></pre>"},{"location":"models/#unique-constraint","title":"Unique Constraint","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n\n    email = Column(String(255), unique=True)\n</code></pre>"},{"location":"models/#primary-key-unique","title":"Primary Key + Unique","text":"<pre><code>class User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True)\n    username = Column(String(50), unique=True)\n</code></pre>"},{"location":"models/#foreign-keys","title":"Foreign Keys","text":""},{"location":"models/#basic-foreign-key","title":"Basic Foreign Key","text":"<pre><code>class Post(Base):\n    __tablename__ = \"posts\"\n\n    id = Column(Integer, primary_key=True)\n    user_id = Column(Integer, ForeignKey(\"users.id\"), nullable=False)\n</code></pre>"},{"location":"models/#foreign-key-with-on-delete","title":"Foreign Key with ON DELETE","text":"<pre><code>class Post(Base):\n    __tablename__ = \"posts\"\n\n    id = Column(Integer, primary_key=True)\n    user_id = Column(\n        Integer, \n        ForeignKey(\"users.id\", ondelete=\"CASCADE\"),\n        nullable=False\n    )\n</code></pre>"},{"location":"models/#self-referential-fk","title":"Self-Referential FK","text":"<pre><code>class Category(Base):\n    __tablename__ = \"categories\"\n\n    id = Column(Integer, primary_key=True)\n    parent_id = Column(\n        Integer, \n        ForeignKey(\"categories.id\")\n    )\n</code></pre>"},{"location":"models/#indexes","title":"Indexes","text":""},{"location":"models/#automatic-indexes","title":"Automatic Indexes","text":"<p>DBWarden generates indexes for: - Primary key columns - Foreign key columns - Unique columns</p>"},{"location":"models/#manual-indexes-manual-migration","title":"Manual Indexes (Manual Migration)","text":"<p>For custom indexes, use manual migrations:</p> <pre><code>-- V20240215_143000__add_user_indexes.sql\n\n-- upgrade\n\nCREATE INDEX idx_users_username ON users(username);\nCREATE INDEX idx_posts_user_id ON posts(user_id);\nCREATE INDEX idx_posts_created_at ON posts(created_at DESC);\n\n-- rollback\n\nDROP INDEX idx_posts_created_at;\nDROP INDEX idx_posts_user_id;\nDROP INDEX idx_users_username;\n</code></pre>"},{"location":"models/#complete-example","title":"Complete Example","text":"<pre><code>from sqlalchemy import Column, Integer, String, Text, DateTime, ForeignKey\nfrom sqlalchemy.orm import declarative_base\nfrom datetime import datetime\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    username = Column(String(50), unique=True, nullable=False)\n    email = Column(String(255), unique=True, nullable=False)\n    bio = Column(Text)\n    is_active = Column(Integer, default=1)\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n\nclass Post(Base):\n    __tablename__ = \"posts\"\n\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    user_id = Column(Integer, ForeignKey(\"users.id\"), nullable=False)\n    title = Column(String(200), nullable=False)\n    content = Column(Text)\n    view_count = Column(Integer, default=0)\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n\nclass Comment(Base):\n    __tablename__ = \"comments\"\n\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    post_id = Column(Integer, ForeignKey(\"posts.id\"), nullable=False)\n    user_id = Column(Integer, ForeignKey(\"users.id\"), nullable=False)\n    content = Column(Text, nullable=False)\n    created_at = Column(DateTime, default=datetime.utcnow)\n</code></pre>"},{"location":"models/#model-discovery","title":"Model Discovery","text":""},{"location":"models/#auto-discovery","title":"Auto-Discovery","text":"<p>DBWarden automatically finds models in: - <code>models/</code> directory - <code>model/</code> directory</p> <p>Searches up to 5 parent directories from current working directory.</p>"},{"location":"models/#manual-path-configuration","title":"Manual Path Configuration","text":"<p>Set custom paths in <code>.env</code>:</p> <pre><code>STRATA_MODEL_PATHS=app/models/,core/database/models/,shared/models/\n</code></pre>"},{"location":"models/#import-patterns","title":"Import Patterns","text":"<p>DBWarden loads models as modules:</p> <pre><code># models/user.py\nfrom sqlalchemy import Column, Integer, String\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n    # ...\n</code></pre> <pre><code># models/post.py\nfrom sqlalchemy import Column, Integer, String\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass Post(Base):\n    __tablename__ = \"posts\"\n    # ...\n</code></pre>"},{"location":"models/#common-patterns","title":"Common Patterns","text":""},{"location":"models/#enum-values","title":"Enum Values","text":"<pre><code>from sqlalchemy import Enum\nimport enum\n\nclass PostStatus(enum.Enum):\n    DRAFT = \"draft\"\n    PUBLISHED = \"published\"\n    ARCHIVED = \"archived\"\n\nclass Post(Base):\n    __tablename__ = \"posts\"\n\n    status = Column(Enum(PostStatus), default=PostStatus.DRAFT)\n</code></pre>"},{"location":"models/#composite-keys","title":"Composite Keys","text":"<pre><code>class OrderItem(Base):\n    __tablename__ = \"order_items\"\n\n    order_id = Column(Integer, ForeignKey(\"orders.id\"), primary_key=True)\n    product_id = Column(Integer, ForeignKey(\"products.id\"), primary_key=True)\n    quantity = Column(Integer, nullable=False)\n</code></pre>"},{"location":"models/#json-columns","title":"JSON Columns","text":"<pre><code>from sqlalchemy import JSON\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True)\n    preferences = Column(JSON, default=dict)\n</code></pre>"},{"location":"models/#limitations","title":"Limitations","text":""},{"location":"models/#not-supported","title":"Not Supported","text":"<ul> <li>Column comments</li> <li>Table comments</li> <li>Partial indexes (SQLite)</li> <li>Expression indexes (some databases)</li> <li>Deferred constraints</li> </ul> <p>For these features, use manual migrations.</p>"},{"location":"models/#workarounds","title":"Workarounds","text":"<pre><code>-- Add column comment (manual migration)\nCOMMENT ON COLUMN users.email IS 'User email address';\n\n-- Add table comment\nCOMMENT ON TABLE users IS 'Registered user accounts';\n</code></pre>"},{"location":"models/#best-practices","title":"Best Practices","text":""},{"location":"models/#1-naming-conventions","title":"1. Naming Conventions","text":"<pre><code># GOOD\n__tablename__ = \"users\"          # Plural, snake_case\nusername = Column(String(50))    # snake_case\n\n# AVOID\n__tablename__ = \"User\"           # Singular\nUserName = Column(String(50))   # CamelCase\n</code></pre>"},{"location":"models/#2-explicit-types","title":"2. Explicit Types","text":"<pre><code># GOOD: Explicit length\nemail = Column(String(255))\n\n# LESS CLEAR: Default length varies\nemail = Column(String)  # May be 255 or 1 depending on DB\n</code></pre>"},{"location":"models/#3-primary-keys","title":"3. Primary Keys","text":"<pre><code># GOOD: Auto-incrementing integer\nid = Column(Integer, primary_key=True, autoincrement=True)\n\n# OR UUID\nimport uuid\nid = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))\n</code></pre>"},{"location":"models/#4-timestamps","title":"4. Timestamps","text":"<pre><code>from datetime import datetime\n\nclass Model(Base):\n    __tablename__ = \"models\"\n\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n</code></pre>"},{"location":"models/#troubleshooting","title":"Troubleshooting","text":""},{"location":"models/#model-not-discovered","title":"Model Not Discovered","text":"<ol> <li>Check <code>STRATA_MODEL_PATHS</code> in <code>.env</code></li> <li>Verify file is in <code>models/</code> directory</li> <li>Ensure model inherits from <code>Base</code></li> <li>Check <code>__tablename__</code> is defined</li> </ol>"},{"location":"models/#migration-missing-columns","title":"Migration Missing Columns","text":"<ol> <li>Verify column is in model</li> <li>Check for typos in column name</li> <li>Ensure column is defined on model class (not relationship)</li> </ol>"},{"location":"models/#column-type-mismatch","title":"Column Type Mismatch","text":"<p>Migration generates different type than expected:</p> <pre><code># Model\nemail = Column(String(255))\n\n# Generated SQL might be:\n-- VARCHAR(255) for PostgreSQL/MySQL\n-- TEXT for SQLite (no VARCHAR)\n</code></pre> <p>Use manual migrations for database-specific types.</p>"},{"location":"models/#see-also","title":"See Also","text":"<ul> <li>make-migrations: Generate migrations from models</li> <li>new: Create manual migrations for features not in models</li> <li>Supported Databases: Database-specific considerations</li> </ul>"},{"location":"quickstart/","title":"Quick Start","text":"<p>This guide walks you through a complete DBWarden workflow, from initial setup to managing database migrations.</p>"},{"location":"quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10+ installed</li> <li>A database (PostgreSQL, MySQL, or SQLite)</li> <li>Basic familiarity with SQL and SQLAlchemy</li> </ul>"},{"location":"quickstart/#step-1-install-dbwarden","title":"Step 1: Install DBWarden","text":"<pre><code>pip install dbwarden\n</code></pre>"},{"location":"quickstart/#step-2-create-your-project-structure","title":"Step 2: Create Your Project Structure","text":"<pre><code>myproject/\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 models/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 migrations/\n\u2514\u2500\u2500 app.py\n</code></pre>"},{"location":"quickstart/#step-3-configure-database-connection","title":"Step 3: Configure Database Connection","text":"<p>Create a <code>.env</code> file:</p> <pre><code>STRATA_SQLALCHEMY_URL=postgresql://user:password@localhost:5432/myapp\nSTRATA_ASYNC=false\n</code></pre> <p>For SQLite:</p> <pre><code>STRATA_SQLALCHEMY_URL=sqlite:///./myapp.db\n</code></pre>"},{"location":"quickstart/#step-4-define-your-sqlalchemy-models","title":"Step 4: Define Your SQLAlchemy Models","text":"<p>Create your models in the <code>models/</code> directory:</p> <pre><code># models/user.py\nfrom sqlalchemy import Column, Integer, String, DateTime\nfrom sqlalchemy.orm import declarative_base\nimport datetime\n\nBase = declarative_base()\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    username = Column(String(50), unique=True, nullable=False)\n    email = Column(String(255), unique=True, nullable=False)\n    created_at = Column(DateTime, default=datetime.datetime.utcnow)\n</code></pre>"},{"location":"quickstart/#step-5-initialize-dbwarden","title":"Step 5: Initialize DBWarden","text":"<pre><code>dbwarden init\n</code></pre> <p>Output:</p> <pre><code>DBWarden migrations directory created: /home/user/myproject/migrations\n\nNext steps:\n  1. Create a .env file with STRATA_SQLALCHEMY_URL\n  2. Run 'dbwarden make-migrations' to generate migrations from your models\n</code></pre>"},{"location":"quickstart/#step-6-generate-migration-from-models","title":"Step 6: Generate Migration from Models","text":"<pre><code>dbwarden make-migrations \"create users table\"\n</code></pre> <p>Output:</p> <pre><code>Created migration file: /home/user/myproject/migrations/V20240215_143000__create_users_table.sql\nTables included: users\n</code></pre>"},{"location":"quickstart/#step-7-review-the-migration","title":"Step 7: Review the Migration","text":"<p>Check the generated SQL:</p> <pre><code>-- migrations/V20240215_143000__create_users_table.sql\n\n-- upgrade\n\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    created_at DATETIME\n)\n\n-- rollback\n\nDROP TABLE users\n</code></pre>"},{"location":"quickstart/#step-8-apply-the-migration","title":"Step 8: Apply the Migration","text":"<pre><code>dbwarden migrate --verbose\n</code></pre> <p>Output:</p> <pre><code>[INFO] Applying migration: V20240215_143000__create_users_table.sql\nMigrations completed successfully: 1 migrations applied.\n</code></pre>"},{"location":"quickstart/#step-9-check-migration-status","title":"Step 9: Check Migration Status","text":"<pre><code>dbwarden status\n</code></pre> <p>Output:</p> <pre><code>Migration Status\n================\n\u2713 Applied   | V20240215_143000__create_users_table\n\nApplied: 1\nPending: 0\nTotal: 1\n</code></pre>"},{"location":"quickstart/#step-10-view-migration-history","title":"Step 10: View Migration History","text":"<pre><code>dbwarden history\n</code></pre> <p>Output:</p> <pre><code>Migration History\n=================\nVersion         | Order | Description     | Applied At           | Type\n----------------|-------|-----------------|----------------------|------\n20240215_143000 | 1     | create users    | 2024-02-15 14:30:15  | versioned\n</code></pre>"},{"location":"quickstart/#step-11-add-more-changes","title":"Step 11: Add More Changes","text":"<p>Add a new table to your models:</p> <pre><code># models/post.py\nfrom sqlalchemy import Column, Integer, String, Text, ForeignKey\nfrom sqlalchemy.orm import declarative_base\n\nBase = declarative_base()\n\nclass Post(Base):\n    __tablename__ = \"posts\"\n\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    title = Column(String(200), nullable=False)\n    content = Column(Text)\n    user_id = Column(Integer, ForeignKey(\"users.id\"), nullable=False)\n</code></pre> <p>Generate a new migration:</p> <pre><code>dbwarden make-migrations \"create posts table\"\ndbwarden migrate\n</code></pre>"},{"location":"quickstart/#step-12-rollback-if-needed","title":"Step 12: Rollback (If Needed)","text":"<p>Revert the last migration:</p> <pre><code>dbwarden rollback\n</code></pre> <p>Or rollback to a specific version:</p> <pre><code>dbwarden rollback --to-version 20240215_143000\n</code></pre>"},{"location":"quickstart/#step-13-check-database-schema","title":"Step 13: Check Database Schema","text":"<p>Inspect your current database schema:</p> <pre><code>dbwarden check-db --out txt\n</code></pre> <p>Output:</p> <pre><code>Table: users\n----------\n  id: INTEGER PRIMARY KEY AUTOINCREMENT\n  username: VARCHAR(50) NOT NULL UNIQUE\n  email: VARCHAR(255) NOT NULL UNIQUE\n  created_at: DATETIME NULL\n</code></pre>"},{"location":"quickstart/#common-workflows","title":"Common Workflows","text":""},{"location":"quickstart/#daily-development","title":"Daily Development","text":"<pre><code># 1. Make changes to your models\n# 2. Generate migration\ndbwarden make-migrations \"describe your changes\"\n\n# 3. Apply migration\ndbwarden migrate --verbose\n\n# 4. Check status\ndbwarden status\n</code></pre>"},{"location":"quickstart/#deploying-to-production","title":"Deploying to Production","text":"<pre><code># 1. Review pending migrations\ndbwarden status\n\n# 2. Apply with verbose to monitor\ndbwarden migrate --verbose\n\n# 3. Verify\ndbwarden history\n</code></pre>"},{"location":"quickstart/#rolling-back-a-bad-migration","title":"Rolling Back a Bad Migration","text":"<pre><code># 1. Check history\ndbwarden history\n\n# 2. Rollback the last migration\ndbwarden rollback\n\n# 3. Or rollback to specific version\ndbwarden rollback --to-version 20240215_143000\n</code></pre>"},{"location":"quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Migration Files structure</li> <li>Explore Commands in detail</li> <li>Understand SQLAlchemy Models integration</li> <li>Check Advanced Features for more options</li> </ul>"},{"location":"commands/check-db/","title":"check-db Command","text":"<p>Inspect and display the live database schema.</p>"},{"location":"commands/check-db/#description","title":"Description","text":"<p>The <code>check-db</code> command connects to your database and displays information about its current schema, including tables, columns, indexes, and foreign keys.</p>"},{"location":"commands/check-db/#usage","title":"Usage","text":"<pre><code>dbwarden check-db\n</code></pre>"},{"location":"commands/check-db/#options","title":"Options","text":"Option Description <code>--out</code>, <code>-o</code> Output format: <code>txt</code> (default), <code>json</code>, <code>yaml</code>"},{"location":"commands/check-db/#examples","title":"Examples","text":""},{"location":"commands/check-db/#text-output-default","title":"Text Output (Default)","text":"<pre><code>$ dbwarden check-db\n\nTable: users\n----------\n  id: INTEGER PRIMARY KEY AUTOINCREMENT\n  username: VARCHAR(50) NOT NULL UNIQUE\n  email: VARCHAR(255) NOT NULL UNIQUE\n  created_at: DATETIME NULL\n\n  Indexes:\n    - idx_users_email: email\n\nTable: posts\n----------\n  id: INTEGER PRIMARY KEY AUTOINCREMENT\n  user_id: INTEGER NOT NULL\n  title: VARCHAR(200) NOT NULL\n  content: TEXT NULL\n\n  Foreign Keys:\n    - fk_posts_user_id: user_id -&gt; users(id)\n</code></pre>"},{"location":"commands/check-db/#json-output","title":"JSON Output","text":"<pre><code>$ dbwarden check-db --out json\n{\n  \"users\": {\n    \"columns\": [\n      {\"name\": \"id\", \"type\": \"INTEGER\", \"nullable\": false, \"default\": null},\n      {\"name\": \"username\", \"type\": \"VARCHAR(50)\", \"nullable\": false, \"default\": null}\n    ],\n    \"indexes\": [{\"name\": \"idx_users_email\", \"columns\": [\"email\"]}],\n    \"foreign_keys\": []\n  }\n}\n</code></pre>"},{"location":"commands/check-db/#yaml-output","title":"YAML Output","text":"<pre><code>$ dbwarden check-db --out yaml\nusers:\n  columns:\n  - {default: null, name: id, nullable: false, type: INTEGER}\n  - {default: null, name: username, nullable: false, type: VARCHAR(50)}\n  foreign_keys: []\n  indexes:\n  - {columns: [email], name: idx_users_email}\n</code></pre>"},{"location":"commands/check-db/#what-it-inspects","title":"What It Inspects","text":""},{"location":"commands/check-db/#tables","title":"Tables","text":"<ul> <li>All tables in the database</li> <li>Tables in specific PostgreSQL schema (if <code>STRATA_POSTGRES_SCHEMA</code> is set)</li> </ul>"},{"location":"commands/check-db/#columns","title":"Columns","text":"<p>For each table, displays: - Column name - Data type - Nullable status - Default value</p>"},{"location":"commands/check-db/#indexes","title":"Indexes","text":"<ul> <li>Index name</li> <li>Indexed columns</li> <li>Index type (if available)</li> </ul>"},{"location":"commands/check-db/#foreign-keys","title":"Foreign Keys","text":"<ul> <li>Constraint name</li> <li>Local columns</li> <li>Referenced table</li> <li>Referenced columns</li> </ul>"},{"location":"commands/check-db/#use-cases","title":"Use Cases","text":""},{"location":"commands/check-db/#documentation","title":"Documentation","text":"<p>Generate schema documentation:</p> <pre><code>dbwarden check-db --out yaml &gt; schema.yaml\n</code></pre>"},{"location":"commands/check-db/#debugging","title":"Debugging","text":"<p>Compare expected vs actual schema:</p> <pre><code># Your expected schema from models\n# vs actual database schema\ndbwarden check-db\n</code></pre>"},{"location":"commands/check-db/#integration","title":"Integration","text":"<p>Use in scripts with JSON output:</p> <pre><code>SCHEMA=$(dbwarden check-db --out json)\n# Process with jq or other tools\necho \"$SCHEMA\" | jq '.users.columns | length'\n</code></pre>"},{"location":"commands/check-db/#migration-verification","title":"Migration Verification","text":"<p>Before and after migration checks:</p> <pre><code># Before\ndbwarden check-db &gt; before.json\n\n# Apply migration\ndbwarden migrate\n\n# After\ndbwarden check-db &gt; after.json\n\n# Compare\ndiff before.json after.json\n</code></pre>"},{"location":"commands/check-db/#technical-details","title":"Technical Details","text":""},{"location":"commands/check-db/#connection-used","title":"Connection Used","text":"<p>Uses the same database connection as other commands: - Reads from <code>.env</code> configuration - Uses <code>STRATA_SQLALCHEMY_URL</code> - Respects <code>STRATA_ASYNC</code> setting</p>"},{"location":"commands/check-db/#schema-inspection","title":"Schema Inspection","text":"<p>Uses SQLAlchemy's <code>inspect</code> function:</p> <pre><code>from sqlalchemy import inspect\ninspector = inspect(connection)\ntables = inspector.get_table_names()\n</code></pre>"},{"location":"commands/check-db/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/check-db/#connection-failed","title":"Connection Failed","text":"<p>Verify database connection:</p> <pre><code>dbwarden env\n# Check STRATA_SQLALCHEMY_URL is correct\n\n# Test connection\npython -c \"from sqlalchemy import create_engine; engine = create_engine('$URL'); engine.connect()\"\n</code></pre>"},{"location":"commands/check-db/#empty-output","title":"Empty Output","text":"<p>No tables found: 1. Check migrations were applied: <code>dbwarden history</code> 2. Verify correct database: Check connection URL 3. Check PostgreSQL schema: Set <code>STRATA_POSTGRES_SCHEMA</code></p>"},{"location":"commands/check-db/#best-practices","title":"Best Practices","text":"<ol> <li>Use before migrations: Document current state</li> <li>Use after migrations: Verify changes</li> <li>Version control schema: Store <code>check-db</code> output in docs</li> <li>JSON for automation: Use JSON format in scripts</li> </ol>"},{"location":"commands/check-db/#see-also","title":"See Also","text":"<ul> <li>diff: Compare models vs database</li> <li>history: View migration history</li> <li>status: Check migration status</li> </ul>"},{"location":"commands/diff/","title":"diff Command","text":"<p>Show structural differences between models and database.</p>"},{"location":"commands/diff/#description","title":"Description","text":"<p>The <code>diff</code> command compares your SQLAlchemy model definitions against the actual database schema to identify discrepancies.</p>"},{"location":"commands/diff/#usage","title":"Usage","text":"<pre><code>dbwarden diff [type]\n</code></pre>"},{"location":"commands/diff/#arguments","title":"Arguments","text":"Argument Description <code>type</code> Type of diff: <code>models</code>, <code>migrations</code>, <code>all</code> (default: <code>all</code>)"},{"location":"commands/diff/#options","title":"Options","text":"Option Description <code>--verbose</code>, <code>-v</code> Enable verbose logging"},{"location":"commands/diff/#examples","title":"Examples","text":""},{"location":"commands/diff/#compare-models-vs-database","title":"Compare Models vs Database","text":"<pre><code>dbwarden diff\n</code></pre>"},{"location":"commands/diff/#verbose-output","title":"Verbose Output","text":"<pre><code>dbwarden diff --verbose\n</code></pre>"},{"location":"commands/diff/#what-it-shows","title":"What It Shows","text":""},{"location":"commands/diff/#new-tables-in-models-not-in-db","title":"New Tables (in models, not in DB)","text":"<p>Tables defined in your models but not yet created in the database.</p>"},{"location":"commands/diff/#missing-columns-in-db-not-in-models","title":"Missing Columns (in DB, not in models)","text":"<p>Columns in the database that don't have corresponding model definitions.</p>"},{"location":"commands/diff/#type-mismatches","title":"Type Mismatches","text":"<p>Columns where the data type differs between model and database.</p>"},{"location":"commands/diff/#missing-indexes","title":"Missing Indexes","text":"<p>Indexes that exist in models (via SQLAlchemy) but not in database.</p>"},{"location":"commands/diff/#use-cases","title":"Use Cases","text":""},{"location":"commands/diff/#before-migration","title":"Before Migration","text":"<p>Check what will be created:</p> <pre><code>dbwarden diff\n# Shows tables/columns that need to be added\n</code></pre>"},{"location":"commands/diff/#after-migration-issues","title":"After Migration Issues","text":"<p>Debug schema inconsistencies:</p> <pre><code>dbwarden diff\n# Shows discrepancies\n</code></pre>"},{"location":"commands/diff/#schema-drift-detection","title":"Schema Drift Detection","text":"<p>Identify when database schema doesn't match code:</p> <pre><code>dbwarden diff\n# Compare current state\n</code></pre>"},{"location":"commands/diff/#requirements","title":"Requirements","text":"<p>For <code>diff</code> to work effectively:</p> <ol> <li>Models must be defined: SQLAlchemy models in <code>models/</code> directory</li> <li>STRATA_MODEL_PATHS: Must be set or auto-discovery must find models</li> <li>Migrations table exists: At least one migration applied</li> </ol>"},{"location":"commands/diff/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/diff/#no-models-found","title":"No Models Found","text":"<pre><code>No SQLAlchemy models found. Please:\n  1. Create models/ directory with your SQLAlchemy models\n  2. Or set STRATA_MODEL_PATHS in .env\n</code></pre> <p>Set model paths:</p> <pre><code>STRATA_MODEL_PATHS=models/,app/models/\n</code></pre>"},{"location":"commands/diff/#no-migrations-table","title":"No Migrations Table","text":"<pre><code>No migrations table found. Run 'dbwarden migrate' first.\n</code></pre> <p>Apply at least one migration before using <code>diff</code>.</p>"},{"location":"commands/diff/#best-practices","title":"Best Practices","text":"<ol> <li>Run before migrations: See what changes are pending</li> <li>Run after issues: Debug schema problems</li> <li>Use with check-db: Combine for comprehensive view</li> </ol>"},{"location":"commands/diff/#see-also","title":"See Also","text":"<ul> <li>check-db: Inspect current database schema</li> <li>make-migrations: Generate migrations from differences</li> <li>models: SQLAlchemy model integration</li> </ul>"},{"location":"commands/env/","title":"env Command","text":"<p>Display environment configuration without exposing sensitive data.</p>"},{"location":"commands/env/#description","title":"Description","text":"<p>The <code>env</code> command shows relevant environment variables for DBWarden, masking sensitive information like passwords.</p>"},{"location":"commands/env/#usage","title":"Usage","text":"<pre><code>dbwarden env\n</code></pre>"},{"location":"commands/env/#examples","title":"Examples","text":""},{"location":"commands/env/#basic-usage","title":"Basic Usage","text":"<pre><code>$ dbwarden env\nSTRATA_SQLALCHEMY_URL: ***\nSTRATA_ASYNC: true\nSTRATA_MODEL_PATHS: models/,app/models/\nSTRATA_POSTGRES_SCHEMA: public\n</code></pre>"},{"location":"commands/env/#missing-variables","title":"Missing Variables","text":"<p>If some variables are not set, they won't appear in output.</p>"},{"location":"commands/env/#what-it-shows","title":"What It Shows","text":"Variable Displayed As Description <code>STRATA_SQLALCHEMY_URL</code> <code>***</code> Database URL (masked) <code>STRATA_ASYNC</code> Actual value Sync/async mode <code>STRATA_MODEL_PATHS</code> Actual value Model paths <code>STRATA_POSTGRES_SCHEMA</code> Actual value PostgreSQL schema"},{"location":"commands/env/#use-cases","title":"Use Cases","text":""},{"location":"commands/env/#debugging-configuration","title":"Debugging Configuration","text":"<p>Verify configuration is loaded:</p> <pre><code>dbwarden env\n# Check values are as expected\n</code></pre>"},{"location":"commands/env/#sharing-configuration","title":"Sharing Configuration","text":"<p>Safely share configuration (without secrets):</p> <pre><code>dbwarden env\n# Copy output to share (no passwords visible)\n</code></pre>"},{"location":"commands/env/#cicd-debugging","title":"CI/CD Debugging","text":"<p>Debug environment in CI:</p> <pre><code>dbwarden env\n# Log output (safe, no secrets)\n</code></pre>"},{"location":"commands/env/#security","title":"Security","text":"<p>The <code>env</code> command is designed to be safe for: - Debugging logs - Error messages - CI/CD output - Team communication</p> <p>Secrets are never displayed.</p>"},{"location":"commands/env/#related-commands","title":"Related Commands","text":""},{"location":"commands/env/#validate-configuration","title":"Validate Configuration","text":"<pre><code>dbwarden env        # Check config\ndbwarden status     # Validate migrations\n</code></pre>"},{"location":"commands/env/#check-mode","title":"Check Mode","text":"<pre><code>dbwarden env        # Shows STRATA_ASYNC\ndbwarden mode       # Shows just the mode\n</code></pre>"},{"location":"commands/env/#see-also","title":"See Also","text":"<ul> <li>mode: Display sync/async mode</li> <li>configuration: Environment variable reference</li> </ul>"},{"location":"commands/history/","title":"history Command","text":"<p>Display the complete migration history.</p>"},{"location":"commands/history/#description","title":"Description","text":"<p>The <code>history</code> command shows a formatted table of all migrations that have been applied to the database, including their version, description, and when they were applied.</p>"},{"location":"commands/history/#usage","title":"Usage","text":"<pre><code>dbwarden history\n</code></pre>"},{"location":"commands/history/#examples","title":"Examples","text":""},{"location":"commands/history/#basic-usage","title":"Basic Usage","text":"<pre><code>$ dbwarden history\nMigration History\n=================\nVersion         | Order | Description     | Applied At           | Type\n----------------|-------|-----------------|----------------------|------\n20240215_143000 | 1     | create users    | 2024-02-15 14:30:15  | versioned\n20240215_143001 | 2     | create posts    | 2024-02-15 14:30:20  | versioned\n20240215_143002 | 3     | add comments    | 2024-02-15 14:30:25  | versioned\n</code></pre>"},{"location":"commands/history/#no-migrations-applied","title":"No Migrations Applied","text":"<pre><code>No migrations have been applied yet.\n</code></pre>"},{"location":"commands/history/#output-columns","title":"Output Columns","text":"Column Description Version Migration version identifier Order Sequence number of execution Description Migration description/name Applied At Timestamp when migration was applied Type Migration type (versioned)"},{"location":"commands/history/#what-it-shows","title":"What It Shows","text":"<ul> <li>All successfully applied migrations</li> <li>Chronological order of application</li> <li>Execution sequence (order executed)</li> <li>Timestamps for each migration</li> </ul>"},{"location":"commands/history/#use-cases","title":"Use Cases","text":""},{"location":"commands/history/#checking-applied-migrations","title":"Checking Applied Migrations","text":"<p>Verify which migrations are in the database:</p> <pre><code>dbwarden history\n</code></pre>"},{"location":"commands/history/#debugging-issues","title":"Debugging Issues","text":"<p>When troubleshooting schema issues:</p> <pre><code>dbwarden history\n# Check order and timing of migrations\n</code></pre>"},{"location":"commands/history/#auditing","title":"Auditing","text":"<p>For compliance and auditing:</p> <pre><code>dbwarden history &gt; migration_audit_$(date +%Y%m%d).txt\n</code></pre>"},{"location":"commands/history/#related-commands","title":"Related Commands","text":""},{"location":"commands/history/#compare-with-local-files","title":"Compare with Local Files","text":"<pre><code>dbwarden history     # Database state\ndbwarden status     # Compare with local files\n</code></pre>"},{"location":"commands/history/#check-pending-migrations","title":"Check Pending Migrations","text":"<pre><code>dbwarden history     # What's applied\ndbwarden status     # Plus what's pending\n</code></pre>"},{"location":"commands/history/#database-source","title":"Database Source","text":"<p>The history is read from the <code>strata_migrations</code> table in your database:</p> <pre><code>SELECT * FROM strata_migrations ORDER BY applied_at;\n</code></pre>"},{"location":"commands/history/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/history/#no-migrations-have-been-applied-yet","title":"\"No migrations have been applied yet\"","text":"<p>This means either: 1. No migrations have been run 2. The <code>strata_migrations</code> table doesn't exist 3. Running <code>dbwarden migrate</code> for the first time</p>"},{"location":"commands/history/#empty-history-despite-migrations","title":"Empty History Despite Migrations","text":"<p>If migrations were applied but history is empty:</p> <ol> <li>Check you're connecting to the correct database</li> <li>Verify <code>.env</code> configuration</li> <li>Check <code>strata_migrations</code> table exists:</li> </ol> <pre><code>dbwarden check-db --out txt\n# Look for strata_migrations table\n</code></pre>"},{"location":"commands/history/#best-practices","title":"Best Practices","text":"<ol> <li>Regular checks: Review history after deployments</li> <li>Documentation: Note migration purposes in descriptions</li> <li>Retention: Archive history for audit trails</li> </ol>"},{"location":"commands/history/#see-also","title":"See Also","text":"<ul> <li>status: Show applied and pending migrations</li> <li>migrate: Apply migrations</li> <li>rollback: Revert migrations</li> </ul>"},{"location":"commands/init/","title":"init Command","text":"<p>Initialize the DBWarden migrations directory.</p>"},{"location":"commands/init/#description","title":"Description","text":"<p>The <code>init</code> command creates the <code>migrations/</code> directory that will store all your migration files. This is the first command you run when setting up DBWarden in a new project.</p>"},{"location":"commands/init/#usage","title":"Usage","text":"<pre><code>dbwarden init\n</code></pre>"},{"location":"commands/init/#what-it-does","title":"What It Does","text":"<ol> <li>Creates a <code>migrations/</code> directory in the current working directory</li> <li>Sets up the directory structure for storing migration files</li> <li>Does NOT create any database tables or modify the database</li> </ol>"},{"location":"commands/init/#example","title":"Example","text":"<pre><code>$ dbwarden init\nDBWarden migrations directory created: /home/user/myproject/migrations\n\nNext steps:\n  1. Create a .env file with STRATA_SQLALCHEMY_URL\n  2. Run 'dbwarden make-migrations' to generate migrations from your models\n</code></pre>"},{"location":"commands/init/#directory-structure","title":"Directory Structure","text":"<p>After running <code>init</code>, your project structure will look like:</p> <pre><code>myproject/\n\u251c\u2500\u2500 migrations/          # Created by init command\n\u2502   \u2514\u2500\u2500 .gitkeep        # Placeholder file\n\u251c\u2500\u2500 models/\n\u2502   \u2514\u2500\u2500 user.py\n\u251c\u2500\u2500 .env\n\u2514\u2500\u2500 app.py\n</code></pre>"},{"location":"commands/init/#important-notes","title":"Important Notes","text":"<ul> <li>No database changes: This command only creates a local directory</li> <li>Safe to run multiple times: Running <code>init</code> again is safe; it won't overwrite existing migrations</li> <li>Required before other commands: Most DBWarden commands require the migrations directory to exist</li> </ul>"},{"location":"commands/init/#see-also","title":"See Also","text":"<ul> <li>make-migrations: Generate migrations from models</li> <li>new: Create manual migrations</li> </ul>"},{"location":"commands/lock/","title":"lock-status and unlock Commands","text":"<p>Manage migration locking to prevent concurrent execution.</p>"},{"location":"commands/lock/#description","title":"Description","text":"<p>DBWarden uses a locking mechanism to ensure only one migration process can run at a time. These commands allow you to check and manage the lock state.</p>"},{"location":"commands/lock/#commands","title":"Commands","text":""},{"location":"commands/lock/#lock-status","title":"lock-status","text":"<p>Check if a migration lock is currently active.</p> <pre><code>dbwarden lock-status\n</code></pre> <p>Output (Lock Active):</p> <pre><code>Migration lock: ACTIVE\nAnother migration process may be running.\n</code></pre> <p>Output (No Lock):</p> <pre><code>Migration lock: INACTIVE\n</code></pre>"},{"location":"commands/lock/#unlock","title":"unlock","text":"<p>Release the migration lock (emergency use only).</p> <pre><code>dbwarden unlock\n</code></pre> <p>Output:</p> <pre><code>Migration lock released successfully.\n</code></pre> <p>Or if no lock was held:</p> <pre><code>Failed to release lock. Lock may not be held.\n</code></pre>"},{"location":"commands/lock/#locking-mechanism","title":"Locking Mechanism","text":""},{"location":"commands/lock/#purpose","title":"Purpose","text":"<p>Prevent concurrent migration execution: - Avoids race conditions - Prevents schema conflicts - Ensures migration order</p>"},{"location":"commands/lock/#how-it-works","title":"How It Works","text":"<ol> <li>Lock is acquired before any migration operation</li> <li>Lock is released after completion or error</li> <li>Other processes wait or fail when lock is held</li> </ol>"},{"location":"commands/lock/#lock-table","title":"Lock Table","text":"<p>DBWarden creates a <code>strata_lock</code> table:</p> <pre><code>CREATE TABLE strata_lock (\n    id INTEGER PRIMARY KEY,\n    locked BOOLEAN DEFAULT FALSE,\n    acquired_at DATETIME,\n    release_at DATETIME\n);\n</code></pre>"},{"location":"commands/lock/#when-locks-are-used","title":"When Locks Are Used","text":"Command Acquires Lock Releases Lock <code>migrate</code> Yes Yes <code>rollback</code> Yes Yes <code>make-migrations</code> No No <code>new</code> No No <code>history</code> No No <code>status</code> No No <code>check-db</code> No No"},{"location":"commands/lock/#common-scenarios","title":"Common Scenarios","text":""},{"location":"commands/lock/#scenario-1-normal-operation","title":"Scenario 1: Normal Operation","text":"<pre><code># Terminal 1\ndbwarden migrate\n# Lock acquired, migration runs, lock released\n\n# Terminal 2 (while T1 running)\ndbwarden migrate\n# Sees lock, waits or fails\n</code></pre>"},{"location":"commands/lock/#scenario-2-lock-held-after-error","title":"Scenario 2: Lock Held After Error","text":"<pre><code># Migration fails mid-way\n# Lock is NOT released\n# Database may be in inconsistent state\n\n# Check lock status\ndbwarden lock-status\n# Shows: ACTIVE\n\n# Investigate issue first\n# Then release if safe\ndbwarden unlock\n</code></pre>"},{"location":"commands/lock/#scenario-3-stuck-process","title":"Scenario 3: Stuck Process","text":"<pre><code># Process killed or crashed\n# Lock remains active\n\n# Check\ndbwarden lock-status\n# ACTIVE\n\n# Force unlock (after verifying no other process)\ndbwarden unlock\n</code></pre>"},{"location":"commands/lock/#best-practices","title":"Best Practices","text":""},{"location":"commands/lock/#do","title":"Do","text":"<ul> <li>Check <code>lock-status</code> before assuming deadlock</li> <li>Investigate why lock exists</li> <li>Ensure no other process is running</li> <li>Document lock releases</li> </ul>"},{"location":"commands/lock/#dont","title":"Don't","text":"<ul> <li>Don't <code>unlock</code> without checking</li> <li>Don't <code>unlock</code> if another process is running</li> <li>Don't run concurrent migrations manually</li> </ul>"},{"location":"commands/lock/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/lock/#lock-active-during-deployment","title":"Lock Active During Deployment","text":"<pre><code># 1. Check what's running\nps aux | grep dbwarden\n\n# 2. Check lock status\ndbwarden lock-status\n\n# 3. Wait if safe\n# OR force unlock if certain\ndbwarden unlock\n</code></pre>"},{"location":"commands/lock/#lock-not-releasing","title":"Lock Not Releasing","text":"<pre><code># Check database state\ndbwarden check-db --out txt\n# Look for strata_lock table\n\n# Manual lock check\npsql $DATABASE_URL -c \"SELECT * FROM strata_lock;\"\n</code></pre>"},{"location":"commands/lock/#migration-stuck-at-lock","title":"Migration Stuck at Lock","text":"<pre><code># Kill stuck process\npkill -f dbwarden\n\n# Release lock\ndbwarden unlock\n\n# Check status\ndbwarden status\ndbwarden history\n</code></pre>"},{"location":"commands/lock/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"commands/lock/#force-unlock-when-safe","title":"Force Unlock (When Safe)","text":"<pre><code># 1. Verify no dbwarden process running\nps aux | grep -i dbwarden\n\n# 2. Check no connections\n# PostgreSQL:\npsql $DATABASE_URL -c \"SELECT pid FROM pg_stat_activity WHERE state = 'active';\"\n\n# 3. Release lock\ndbwarden unlock\n\n# 4. Verify\ndbwarden lock-status\n</code></pre>"},{"location":"commands/lock/#manual-lock-release","title":"Manual Lock Release","text":"<p>If <code>unlock</code> fails:</p> <pre><code>-- SQL to manually release lock\nUPDATE strata_lock SET locked = FALSE, release_at = NOW();\n</code></pre>"},{"location":"commands/lock/#see-also","title":"See Also","text":"<ul> <li>migrate: Migration execution</li> <li>rollback: Rollback execution</li> </ul>"},{"location":"commands/make-migrations/","title":"make-migrations Command","text":"<p>Automatically generate SQL migration files from SQLAlchemy models.</p>"},{"location":"commands/make-migrations/#description","title":"Description","text":"<p>The <code>make-migrations</code> command analyzes your SQLAlchemy models and generates corresponding SQL migration files. This is the primary way to create migrations when working with ORM models.</p>"},{"location":"commands/make-migrations/#usage","title":"Usage","text":"<pre><code>dbwarden make-migrations \"description of changes\"\n</code></pre>"},{"location":"commands/make-migrations/#arguments","title":"Arguments","text":"Argument Description <code>description</code> A descriptive name for the migration (optional)"},{"location":"commands/make-migrations/#options","title":"Options","text":"Option Description <code>--verbose</code>, <code>-v</code> Enable verbose logging"},{"location":"commands/make-migrations/#examples","title":"Examples","text":""},{"location":"commands/make-migrations/#basic-usage","title":"Basic Usage","text":"<pre><code>dbwarden make-migrations \"create users table\"\n</code></pre>"},{"location":"commands/make-migrations/#with-verbose-output","title":"With Verbose Output","text":"<pre><code>dbwarden make-migrations \"add posts and comments\" --verbose\n</code></pre>"},{"location":"commands/make-migrations/#without-description","title":"Without Description","text":"<pre><code>dbwarden make-migrations\n</code></pre> <p>If no description is provided, a timestamp-based version will be used.</p>"},{"location":"commands/make-migrations/#how-it-works","title":"How It Works","text":"<ol> <li>Model Discovery: Searches for SQLAlchemy models in:</li> <li><code>models/</code> directory (default)</li> <li><code>model/</code> directory (alternative)</li> <li> <p>Custom paths specified in <code>STRATA_MODEL_PATHS</code></p> </li> <li> <p>Table Extraction: Reads table definitions from discovered models:</p> </li> <li>Column names and types</li> <li>Constraints (primary key, foreign key, unique)</li> <li>Default values</li> <li> <p>Nullable status</p> </li> <li> <p>SQL Generation: Creates two sections in the migration file:</p> </li> <li>Upgrade SQL: Creates the tables/structures</li> <li> <p>Rollback SQL: Drops the tables/structures</p> </li> <li> <p>File Creation: Saves the migration with naming pattern:    <code>V{version}__{description}.sql</code></p> </li> </ol>"},{"location":"commands/make-migrations/#generated-file-example","title":"Generated File Example","text":"<pre><code>-- migrations/V20240215_143000__create_users_table.sql\n\n-- upgrade\n\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    created_at DATETIME\n)\n\n-- rollback\n\nDROP TABLE users\n</code></pre>"},{"location":"commands/make-migrations/#requirements","title":"Requirements","text":"<p>Before running <code>make-migrations</code>:</p> <ol> <li>Run <code>dbwarden init</code> to create migrations directory</li> <li>Create <code>.env</code> with <code>STRATA_SQLALCHEMY_URL</code></li> <li>Define SQLAlchemy models with <code>__tablename__</code> attribute</li> </ol>"},{"location":"commands/make-migrations/#validation-checks","title":"Validation Checks","text":"<p>The command performs several validations:</p>"},{"location":"commands/make-migrations/#pending-migrations-check","title":"Pending Migrations Check","text":"<p>If migrations are pending, the command will fail:</p> <pre><code>Error: Cannot generate migrations while 3 migrations are pending.\nPlease run 'dbwarden migrate' first.\n</code></pre>"},{"location":"commands/make-migrations/#no-models-found","title":"No Models Found","text":"<p>If no models are found:</p> <pre><code>No SQLAlchemy models found. Please:\n  1. Create models/ directory with your SQLAlchemy models\n  2. Or set STRATA_MODEL_PATHS in .env\n</code></pre>"},{"location":"commands/make-migrations/#model-discovery-process","title":"Model Discovery Process","text":"<p>DBWarden searches for models in this order:</p> <ol> <li>Explicit paths: Paths in <code>STRATA_MODEL_PATHS</code> (comma-separated)</li> <li>Auto-discovery: Looks for <code>models/</code> or <code>model/</code> directories</li> </ol> <p>The search traverses up to 5 parent directories from the current working directory.</p>"},{"location":"commands/make-migrations/#supported-column-types","title":"Supported Column Types","text":"SQLAlchemy Type Generated SQL Type <code>Integer</code> <code>INTEGER</code> <code>String(n)</code> <code>VARCHAR(n)</code> <code>Text</code> <code>TEXT</code> <code>Boolean</code> <code>BOOLEAN</code> <code>DateTime</code> <code>DATETIME</code> <code>Float</code> <code>FLOAT</code> <code>Date</code> <code>DATE</code> <code>JSON</code> <code>JSON</code>"},{"location":"commands/make-migrations/#supported-constraints","title":"Supported Constraints","text":"<ul> <li>Primary Key (<code>primary_key=True</code>)</li> <li>Unique (<code>unique=True</code>)</li> <li>Not Null (<code>nullable=False</code>)</li> <li>Default values</li> <li>Foreign Key (<code>ForeignKey('table.column')</code>)</li> </ul>"},{"location":"commands/make-migrations/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Descriptive names: Use clear descriptions:    <code>bash    dbwarden make-migrations \"add user profile fields\"    # NOT    dbwarden make-migrations \"changes\"</code></p> </li> <li> <p>One feature per migration: Create separate migrations for different features</p> </li> <li> <p>Review generated SQL: Always review the generated SQL before applying</p> </li> <li> <p>Version control: Commit migration files to version control</p> </li> </ol>"},{"location":"commands/make-migrations/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/make-migrations/#models-not-being-discovered","title":"Models Not Being Discovered","text":"<ol> <li>Check <code>STRATA_MODEL_PATHS</code> in <code>.env</code></li> <li>Ensure models have <code>__tablename__</code> attribute</li> <li>Verify models inherit from <code>declarative_base()</code></li> </ol>"},{"location":"commands/make-migrations/#incorrect-sql-generation","title":"Incorrect SQL Generation","text":"<ol> <li>Check SQLAlchemy model definitions</li> <li>Ensure column types are compatible</li> <li>Review generated migration file manually</li> </ol>"},{"location":"commands/make-migrations/#see-also","title":"See Also","text":"<ul> <li>new Command: Create manual migrations</li> <li>SQLAlchemy Models: Model requirements and best practices</li> <li>Migration Files: Understanding migration file structure</li> </ul>"},{"location":"commands/migrate/","title":"migrate Command","text":"<p>Apply pending migrations to the database.</p>"},{"location":"commands/migrate/#description","title":"Description","text":"<p>The <code>migrate</code> command executes all pending migration files, updating the database schema to match your current migration state.</p>"},{"location":"commands/migrate/#usage","title":"Usage","text":"<pre><code>dbwarden migrate\n</code></pre>"},{"location":"commands/migrate/#options","title":"Options","text":"Option Description <code>--count</code>, <code>-c</code> Number of migrations to apply <code>--to-version</code>, <code>-t</code> Migrate to a specific version <code>--verbose</code>, <code>-v</code> Enable verbose logging"},{"location":"commands/migrate/#examples","title":"Examples","text":""},{"location":"commands/migrate/#apply-all-pending-migrations","title":"Apply All Pending Migrations","text":"<pre><code>dbwarden migrate\n</code></pre>"},{"location":"commands/migrate/#apply-with-verbose-output","title":"Apply with Verbose Output","text":"<pre><code>dbwarden migrate --verbose\n</code></pre>"},{"location":"commands/migrate/#apply-specific-number-of-migrations","title":"Apply Specific Number of Migrations","text":"<pre><code># Apply next 2 migrations\ndbwarden migrate --count 2\n</code></pre>"},{"location":"commands/migrate/#migrate-to-specific-version","title":"Migrate to Specific Version","text":"<pre><code>dbwarden migrate --to-version 20240215_143000\n</code></pre>"},{"location":"commands/migrate/#how-it-works","title":"How It Works","text":"<ol> <li>Creates migrations tracking table: Creates <code>strata_migrations</code> table if it doesn't exist</li> <li>Creates lock table: Creates <code>strata_lock</code> table for concurrency control</li> <li>Finds pending migrations: Identifies migrations not yet applied</li> <li>Applies migrations: Executes each migration in order</li> <li>Records execution: Stores migration metadata in database</li> </ol>"},{"location":"commands/migrate/#internal-process","title":"Internal Process","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. Create strata_migrations table (if not exists)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. Create strata_lock table (if not exists)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. Acquire migration lock                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  4. Find pending migrations                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  5. Parse migration files (upgrade statements)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  6. Execute SQL statements                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  7. Record migration in database                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  8. Release lock                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"commands/migrate/#migrations-tracking-table","title":"Migrations Tracking Table","text":"<p>DBWarden creates a <code>strata_migrations</code> table to track applied migrations:</p> Column Type Description <code>id</code> INTEGER Auto-increment ID <code>version</code> VARCHAR Migration version <code>description</code> VARCHAR Migration description <code>filename</code> VARCHAR Migration filename <code>migration_type</code> VARCHAR Type (versioned) <code>checksum</code> VARCHAR File checksum for validation <code>applied_at</code> DATETIME Timestamp of application"},{"location":"commands/migrate/#locking-mechanism","title":"Locking Mechanism","text":"<p>DBWarden uses a locking mechanism to prevent concurrent migration execution:</p> <ul> <li>Automatic lock acquisition: Lock is acquired before any migration</li> <li>Lock release: Lock is released after completion or error</li> <li>Lock timeout: Prevents stale locks</li> </ul>"},{"location":"commands/migrate/#checking-lock-status","title":"Checking Lock Status","text":"<pre><code>dbwarden lock-status\n</code></pre>"},{"location":"commands/migrate/#force-unlock-emergency","title":"Force Unlock (Emergency)","text":"<pre><code>dbwarden unlock\n</code></pre> <p>Warning: Only use <code>unlock</code> if you're certain no other migration process is running.</p>"},{"location":"commands/migrate/#output-examples","title":"Output Examples","text":""},{"location":"commands/migrate/#successful-migration","title":"Successful Migration","text":"<pre><code>[INFO] Applying migration: V20240215_143000__create_users.sql\n[INFO] Applying migration: V20240215_143001__create_posts.sql\nMigrations completed successfully: 2 migrations applied.\n</code></pre>"},{"location":"commands/migrate/#verbose-output","title":"Verbose Output","text":"<pre><code>[INFO] Mode: sync\n[INFO] Pending migrations: V20240215_143000__create_users, V20240215_143001__create_posts\n[INFO] Starting migration: V20240215_143000__create_users\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    username VARCHAR(50) NOT NULL\n)\n[INFO] Migration completed: V20240215_143000__create_users in 0.05s\n[INFO] Starting migration: V20240215_143001__create_posts\nCREATE TABLE posts (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    title VARCHAR(200) NOT NULL\n)\n[INFO] Migration completed: V20240215_143001__create_posts in 0.03s\nMigrations completed successfully: 2 migrations applied.\n</code></pre>"},{"location":"commands/migrate/#no-pending-migrations","title":"No Pending Migrations","text":"<pre><code>Migrations are up to date.\n</code></pre>"},{"location":"commands/migrate/#error-handling","title":"Error Handling","text":""},{"location":"commands/migrate/#migration-execution-errors","title":"Migration Execution Errors","text":"<p>If a migration fails:</p> <ol> <li>The migration is not recorded</li> <li>Database changes are rolled back (if in transaction)</li> <li>Error message is displayed</li> </ol>"},{"location":"commands/migrate/#checksum-validation","title":"Checksum Validation","text":"<p>DBWarden validates migration file checksums to ensure integrity:</p> <ul> <li>Before execution: Verifies file hasn't been modified</li> <li>Integrity check: Compares stored checksum with current file</li> </ul>"},{"location":"commands/migrate/#best-practices","title":"Best Practices","text":"<ol> <li>Always use --verbose in production: Log all SQL statements</li> <li>Test migrations first: Run on staging before production</li> <li>Backup before migrating: Especially in production</li> <li>Don't modify applied migrations: Create new migrations instead</li> </ol>"},{"location":"commands/migrate/#rollback-strategy","title":"Rollback Strategy","text":"<p>Before running migrations, understand your rollback options:</p> <pre><code># Check what will be rolled back\ndbwarden history\n\n# Rollback if needed\ndbwarden rollback\n</code></pre>"},{"location":"commands/migrate/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/migrate/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>name: Database Migrations\n\non:\n  push:\n    branches: [main]\n\njobs:\n  migrate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Set up Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install dependencies\n        run: |\n          pip install dbwarden\n\n      - name: Run migrations\n        run: dbwarden migrate --verbose\n        env:\n          STRATA_SQLALCHEMY_URL: ${{ secrets.DATABASE_URL }}\n</code></pre>"},{"location":"commands/migrate/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/migrate/#migrations-are-up-to-date-but-you-expect-changes","title":"\"Migrations are up to date\" but you expect changes","text":"<ol> <li>Check migrations directory exists</li> <li>Verify migrations are in correct format</li> <li>Check <code>dbwarden status</code> for pending migrations</li> </ol>"},{"location":"commands/migrate/#migration-fails-silently","title":"Migration fails silently","text":"<p>Run with <code>--verbose</code> to see detailed logs.</p>"},{"location":"commands/migrate/#lock-held-by-another-process","title":"Lock held by another process","text":"<pre><code>dbwarden lock-status\n# If locked, wait or use:\ndbwarden unlock\n</code></pre>"},{"location":"commands/migrate/#see-also","title":"See Also","text":"<ul> <li>rollback: Revert applied migrations</li> <li>status: Check migration status</li> <li>history: View migration history</li> <li>Lock Management: Understanding migration locks</li> </ul>"},{"location":"commands/mode/","title":"mode Command","text":"<p>Display the current sync/async execution mode.</p>"},{"location":"commands/mode/#description","title":"Description","text":"<p>The <code>mode</code> command shows whether DBWarden is configured to use synchronous or asynchronous database operations.</p>"},{"location":"commands/mode/#usage","title":"Usage","text":"<pre><code>dbwarden mode\n</code></pre>"},{"location":"commands/mode/#examples","title":"Examples","text":""},{"location":"commands/mode/#synchronous-mode","title":"Synchronous Mode","text":"<pre><code>Sync\n</code></pre>"},{"location":"commands/mode/#asynchronous-mode","title":"Asynchronous Mode","text":"<pre><code>Async\n</code></pre>"},{"location":"commands/mode/#what-it-shows","title":"What It Shows","text":"Mode Meaning Sync Synchronous database operations Async Asynchronous database operations"},{"location":"commands/mode/#how-mode-is-determined","title":"How Mode Is Determined","text":"<ol> <li>Environment variable: <code>STRATA_ASYNC=true/false</code></li> <li>Configuration: From <code>.env</code> file</li> </ol>"},{"location":"commands/mode/#configuration","title":"Configuration","text":""},{"location":"commands/mode/#enable-async-mode","title":"Enable Async Mode","text":"<pre><code>STRATA_ASYNC=true\nSTRATA_SQLALCHEMY_URL=postgresql+asyncpg://user:pass@host/db\n</code></pre>"},{"location":"commands/mode/#disable-async-mode","title":"Disable Async Mode","text":"<pre><code>STRATA_ASYNC=false\nSTRATA_SQLALCHEMY_URL=postgresql://user:pass@host/db\n</code></pre>"},{"location":"commands/mode/#use-cases","title":"Use Cases","text":""},{"location":"commands/mode/#debug-connection-issues","title":"Debug Connection Issues","text":"<pre><code>dbwarden mode\n# Verify expected mode\n\n# Check URL matches mode\ndbwarden env\n# Confirm STRATA_SQLALCHEMY_URL has correct driver\n</code></pre>"},{"location":"commands/mode/#verify-cicd-configuration","title":"Verify CI/CD Configuration","text":"<pre><code>dbwarden mode\n# Expected: Async for production\n</code></pre>"},{"location":"commands/mode/#async-vs-sync","title":"Async vs Sync","text":""},{"location":"commands/mode/#synchronous-mode_1","title":"Synchronous Mode","text":"<p>Pros: - Simpler debugging - Better for small applications - Easier error handling</p> <p>Cons: - Blocking operations - Slower for large datasets</p>"},{"location":"commands/mode/#asynchronous-mode_1","title":"Asynchronous Mode","text":"<p>Pros: - Non-blocking - Better for high concurrency - Faster I/O operations</p> <p>Cons: - More complex debugging - Not all drivers support async</p>"},{"location":"commands/mode/#supported-databases","title":"Supported Databases","text":"Database Sync Async PostgreSQL Yes Yes MySQL Yes No SQLite Yes Yes"},{"location":"commands/mode/#see-also","title":"See Also","text":"<ul> <li>env: Show full environment configuration</li> <li>configuration: Configuration guide</li> </ul>"},{"location":"commands/new/","title":"new Command","text":"<p>Create a new manual migration file.</p>"},{"location":"commands/new/#description","title":"Description","text":"<p>The <code>new</code> command creates a blank migration file for manual SQL authoring. Use this when you need to write custom SQL that cannot be auto-generated from models.</p>"},{"location":"commands/new/#usage","title":"Usage","text":"<pre><code>dbwarden new \"description of migration\"\n</code></pre>"},{"location":"commands/new/#arguments","title":"Arguments","text":"Argument Description <code>description</code> Required - A descriptive name for the migration"},{"location":"commands/new/#options","title":"Options","text":"Option Description <code>--version</code>, <code>-v</code> Specific version number for the migration"},{"location":"commands/new/#examples","title":"Examples","text":""},{"location":"commands/new/#basic-usage","title":"Basic Usage","text":"<pre><code>dbwarden new \"add index to users email\"\n</code></pre>"},{"location":"commands/new/#with-custom-version","title":"With Custom Version","text":"<pre><code>dbwarden new \"migrate data from old schema\" --version 2.0.0\n</code></pre>"},{"location":"commands/new/#generated-file-structure","title":"Generated File Structure","text":"<pre><code>-- migrations/V20240215_143000__add_index_to_users_email.sql\n\n-- upgrade\n\n-- add index to users email\n\n-- rollback\n\n-- add index to users email\n</code></pre>"},{"location":"commands/new/#when-to-use-manual-migrations","title":"When to Use Manual Migrations","text":"<p>Use <code>new</code> instead of <code>make-migrations</code> when you need to:</p> <ul> <li>Add indexes: Performance optimizations</li> <li>Add constraints: Advanced constraints not in models</li> <li>Custom data migrations: Transform or clean existing data</li> <li>Database-specific features: Use features specific to your database</li> <li>Complex alterations: Modify multiple tables atomically</li> </ul>"},{"location":"commands/new/#example-adding-an-index","title":"Example: Adding an Index","text":"<pre><code>-- migrations/V20240215_143000__add_users_email_index.sql\n\n-- upgrade\n\nCREATE INDEX idx_users_email ON users(email);\n\n-- rollback\n\nDROP INDEX idx_users_email;\n</code></pre>"},{"location":"commands/new/#example-data-migration","title":"Example: Data Migration","text":"<pre><code>-- migrations/V20240215_143001__normalize_usernames.sql\n\n-- upgrade\n\nUPDATE users\nSET username = LOWER(username)\nWHERE username IS NOT NULL;\n\n-- rollback\n\n-- No rollback needed for data normalization\n</code></pre>"},{"location":"commands/new/#example-complex-schema-change","title":"Example: Complex Schema Change","text":"<pre><code>-- migrations/V20240215_143002__add_post_status.sql\n\n-- upgrade\n\nALTER TABLE posts ADD COLUMN status VARCHAR(20) DEFAULT 'draft';\n\nCREATE TYPE post_status AS ENUM ('draft', 'published', 'archived');\n\nALTER TABLE posts DROP COLUMN status;\nALTER TABLE posts ADD COLUMN status post_status DEFAULT 'draft';\n\n-- rollback\n\nDROP TYPE post_status;\nALTER TABLE posts DROP COLUMN status;\nALTER TABLE posts ADD COLUMN status VARCHAR(20) DEFAULT 'draft';\n</code></pre>"},{"location":"commands/new/#version-numbering","title":"Version Numbering","text":"<p>If you don't specify a version, a timestamp-based version is generated:</p> <pre><code>V{YYYYMMDD_HHMMSS}__{description}.sql\n</code></pre> <p>Custom versions must be unique and typically follow semantic versioning:</p> <pre><code>V1.0.0__initial_schema.sql\nV1.1.0__add_users.sql\nV1.2.0__add_posts.sql\nV2.0.0__breaking_changes.sql\n</code></pre>"},{"location":"commands/new/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Descriptive names: Include what the migration does:    <code>V20240215_143000__add_users_email_index.sql    # NOT    V20240215_143000__index.sql</code></p> </li> <li> <p>Test rollback SQL: Ensure <code>-- rollback</code> section works correctly</p> </li> <li> <p>Idempotent migrations: Write SQL that can be run multiple times safely</p> </li> <li> <p>Document complex migrations: Add comments explaining complex operations</p> </li> <li> <p>Separate concerns: One migration per logical change</p> </li> </ol>"},{"location":"commands/new/#comparison-make-migrations-vs-new","title":"Comparison: make-migrations vs new","text":"Aspect make-migrations new Source SQLAlchemy models Manual Use Case Schema from models Custom SQL Automation Full None Complexity Simple Complex Risk Lower Higher"},{"location":"commands/new/#tips-for-writing-manual-migrations","title":"Tips for Writing Manual Migrations","text":""},{"location":"commands/new/#1-always-include-rollback","title":"1. Always Include Rollback","text":"<pre><code>-- GOOD\nCREATE INDEX idx_users_email ON users(email);\n-- rollback\nDROP INDEX idx_users_email;\n\n-- BAD (no rollback)\nCREATE INDEX idx_users_email ON users(email);\n</code></pre>"},{"location":"commands/new/#2-use-transactions-when-possible","title":"2. Use Transactions When Possible","text":"<pre><code>-- upgrade\nBEGIN;\n-- your SQL here\nCOMMIT;\n</code></pre>"},{"location":"commands/new/#3-handle-existing-data","title":"3. Handle Existing Data","text":"<pre><code>-- upgrade\nALTER TABLE users ADD COLUMN new_field VARCHAR(100);\n\nUPDATE users SET new_field = 'default' WHERE new_field IS NULL;\n\nALTER TABLE users ALTER COLUMN new_field SET NOT NULL;\n</code></pre>"},{"location":"commands/new/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/new/#version-already-exists","title":"Version Already Exists","text":"<pre><code>Error: Migration version already exists.\n</code></pre> <p>Use a different version or description.</p>"},{"location":"commands/new/#empty-migration","title":"Empty Migration","text":"<p>Ensure you write SQL in both <code>-- upgrade</code> and <code>-- rollback</code> sections.</p>"},{"location":"commands/new/#see-also","title":"See Also","text":"<ul> <li>make-migrations: Auto-generate from models</li> <li>migrate: Apply manual migrations</li> <li>Migration Files: Migration file format</li> </ul>"},{"location":"commands/rollback/","title":"rollback Command","text":"<p>Revert applied migrations to a previous state.</p>"},{"location":"commands/rollback/#description","title":"Description","text":"<p>The <code>rollback</code> command undoes migrations that have been applied to the database, reverting schema changes.</p>"},{"location":"commands/rollback/#usage","title":"Usage","text":"<pre><code>dbwarden rollback\n</code></pre>"},{"location":"commands/rollback/#options","title":"Options","text":"Option Description <code>--count</code>, <code>-c</code> Number of migrations to rollback <code>--to-version</code>, <code>-t</code> Rollback to a specific version <code>--verbose</code>, <code>-v</code> Enable verbose logging"},{"location":"commands/rollback/#examples","title":"Examples","text":""},{"location":"commands/rollback/#rollback-last-migration","title":"Rollback Last Migration","text":"<pre><code>dbwarden rollback\n</code></pre>"},{"location":"commands/rollback/#rollback-multiple-migrations","title":"Rollback Multiple Migrations","text":"<pre><code># Rollback last 3 migrations\ndbwarden rollback --count 3\n</code></pre>"},{"location":"commands/rollback/#rollback-to-specific-version","title":"Rollback to Specific Version","text":"<pre><code>dbwarden rollback --to-version 20240215_143000\n</code></pre>"},{"location":"commands/rollback/#how-it-works","title":"How It Works","text":"<ol> <li>Finds applied migrations: Identifies the most recent applied migrations</li> <li>Acquires lock: Prevents concurrent migration operations</li> <li>Parses rollback statements: Extracts SQL from <code>-- rollback</code> section</li> <li>Executes rollback SQL: Reverts the schema changes</li> <li>Records rollback: Removes migration record from tracking table</li> </ol>"},{"location":"commands/rollback/#internal-process","title":"Internal Process","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. Acquire migration lock                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. Get last applied migration(s)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. Parse rollback statements from migration file       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  4. Execute rollback SQL statements                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  5. Remove migration record from database               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  6. Release lock                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"commands/rollback/#understanding-rollback-behavior","title":"Understanding Rollback Behavior","text":""},{"location":"commands/rollback/#with-count","title":"With --count","text":"<pre><code>dbwarden rollback --count 2\n</code></pre> <p>Rolls back the last 2 migrations in reverse order.</p>"},{"location":"commands/rollback/#with-to-version","title":"With --to-version","text":"<pre><code>dbwarden rollback --to-version 20240215_143000\n</code></pre> <p>Rolls back all migrations after and including the specified version.</p>"},{"location":"commands/rollback/#default-behavior","title":"Default Behavior","text":"<p>Without options, rolls back exactly 1 migration.</p>"},{"location":"commands/rollback/#output-examples","title":"Output Examples","text":""},{"location":"commands/rollback/#successful-rollback","title":"Successful Rollback","text":"<pre><code>Rolling back migration: V20240215_143002__create_posts.sql (version: 20240215_143002)\nRollback completed: V20240215_143002__create_posts.sql in 0.03s\nRollback completed successfully: 1 migrations reverted.\n</code></pre>"},{"location":"commands/rollback/#verbose-output","title":"Verbose Output","text":"<pre><code>[INFO] Mode: sync\n[INFO] Rolling back migration: V20240215_143002__create_posts.sql\n[INFO] SQL Statement: DROP TABLE posts\nRollback completed successfully: 1 migrations reverted.\n</code></pre>"},{"location":"commands/rollback/#nothing-to-rollback","title":"Nothing to Rollback","text":"<pre><code>Nothing to rollback.\n</code></pre> <p>This occurs when: - No migrations have been applied - Database is at initial state</p>"},{"location":"commands/rollback/#rollback-considerations","title":"Rollback Considerations","text":""},{"location":"commands/rollback/#data-loss-warning","title":"Data Loss Warning","text":"<p>Rollback operations can result in data loss:</p> <pre><code>-- Example: Rollback drops tables\n-- rollback\nDROP TABLE posts;\n\n-- Data in posts table WILL be lost!\n</code></pre>"},{"location":"commands/rollback/#irreversible-operations","title":"Irreversible Operations","text":"<p>Some operations cannot be rolled back:</p> <ul> <li>DROP TABLE: Data is deleted</li> <li>TRUNCATE: Data is deleted</li> <li>ALTER TABLE (some cases): Changes cannot be undone</li> </ul>"},{"location":"commands/rollback/#safe-rollbacks","title":"Safe Rollbacks","text":"<p>Operations that can be safely rolled back:</p> <ul> <li>CREATE INDEX: Just drop the index</li> <li>ALTER TABLE ADD COLUMN: Drop the column</li> <li>CREATE TABLE: Drop the table</li> </ul>"},{"location":"commands/rollback/#best-practices","title":"Best Practices","text":""},{"location":"commands/rollback/#1-always-have-a-backup","title":"1. Always Have a Backup","text":"<pre><code># Before rollback in production\npg_dump $DATABASE_URL &gt; backup_$(date +%Y%m%d).sql\n</code></pre>"},{"location":"commands/rollback/#2-test-rollbacks","title":"2. Test Rollbacks","text":"<pre><code># Test on staging first\ndbwarden rollback --to-version X\n# Verify application still works\n# If issues, re-apply:\ndbwarden migrate --to-version X\n</code></pre>"},{"location":"commands/rollback/#3-document-rollbacks","title":"3. Document Rollbacks","text":"<p>Note which migrations were rolled back and why:</p> <pre><code># Document in commit or ticket\ngit commit -m \"Rollback posts table - bug in post creation\"\n</code></pre>"},{"location":"commands/rollback/#4-use-version-control","title":"4. Use Version Control","text":"<p>Always have migrations committed before rolling back:</p> <pre><code>git add migrations/\ngit commit -m \"Apply migrations\"\n# ... issues found ...\ngit log --oneline -n 5\n</code></pre>"},{"location":"commands/rollback/#rollback-scenarios","title":"Rollback Scenarios","text":""},{"location":"commands/rollback/#scenario-1-bug-in-migration","title":"Scenario 1: Bug in Migration","text":"<pre><code># Bug discovered after migration applied\ndbwarden history\n# V20240215_143002__create_posts.sql - has bug\n\n# Rollback the buggy migration\ndbwarden rollback --to-version 20240215_143002\n\n# Fix the migration file\n# Re-apply\ndbwarden migrate\n</code></pre>"},{"location":"commands/rollback/#scenario-2-wrong-version-applied","title":"Scenario 2: Wrong Version Applied","text":"<pre><code># Wrong migration applied\ndbwarden status\n# Shows: V2.0.0__breaking_change applied (should be V1.9.0)\n\n# Rollback to correct version\ndbwarden rollback --to-version 1.9.0\n# Correct migrations now at V1.9.0\n</code></pre>"},{"location":"commands/rollback/#scenario-3-complete-reset","title":"Scenario 3: Complete Reset","text":"<pre><code># Rollback all migrations\ndbwarden rollback --count $(dbwarden status | grep \"Applied\" | wc -l)\n# All migrations reverted to clean state\n</code></pre>"},{"location":"commands/rollback/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/rollback/#nothing-to-rollback_1","title":"\"Nothing to rollback\"","text":"<p>Check if migrations were applied:</p> <pre><code>dbwarden history\ndbwarden status\n</code></pre>"},{"location":"commands/rollback/#rollback-fails","title":"Rollback Fails","text":"<ol> <li>Check migration file has <code>-- rollback</code> section</li> <li>Verify rollback SQL is correct</li> <li>Run with <code>--verbose</code> for details</li> </ol>"},{"location":"commands/rollback/#lock-held","title":"Lock Held","text":"<pre><code>dbwarden lock-status\n# If locked, wait or:\ndbwarden unlock\n</code></pre>"},{"location":"commands/rollback/#rollback-and-migrate-together","title":"Rollback and Migrate Together","text":"<p>You can rollback and reapply in one operation:</p> <pre><code># Rollback and reapply\ndbwarden rollback --to-version X\n# Fix migration files\ndbwarden migrate --to-version X\n</code></pre>"},{"location":"commands/rollback/#cicd-rollback","title":"CI/CD Rollback","text":""},{"location":"commands/rollback/#github-actions-rollback","title":"GitHub Actions Rollback","text":"<pre><code>name: Emergency Rollback\n\non:\n  workflow_dispatch:\n    inputs:\n      version:\n        description: 'Version to rollback to'\n        required: true\n\njobs:\n  rollback:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Rollback\n        run: dbwarden rollback --to-version ${{ github.event.inputs.version }}\n        env:\n          STRATA_SQLALCHEMY_URL: ${{ secrets.DATABASE_URL }}\n</code></pre>"},{"location":"commands/rollback/#see-also","title":"See Also","text":"<ul> <li>migrate: Apply migrations forward</li> <li>history: View migration history</li> <li>status: Check current status</li> <li>Migration Files: Understanding rollback SQL</li> </ul>"},{"location":"commands/squash/","title":"squash Command","text":"<p>Merge multiple consecutive migrations into a single migration.</p>"},{"location":"commands/squash/#description","title":"Description","text":"<p>The <code>squash</code> command combines multiple applied migrations into one migration file, simplifying migration history.</p>"},{"location":"commands/squash/#usage","title":"Usage","text":"<pre><code>dbwarden squash\n</code></pre>"},{"location":"commands/squash/#options","title":"Options","text":"Option Description <code>--verbose</code>, <code>-v</code> Enable verbose logging"},{"location":"commands/squash/#examples","title":"Examples","text":""},{"location":"commands/squash/#basic-usage","title":"Basic Usage","text":"<pre><code>dbwarden squash\n</code></pre>"},{"location":"commands/squash/#what-it-does","title":"What It Does","text":"<ol> <li>Collects applied migrations: Gathers all applied migration files</li> <li>Combines upgrade SQL: Merges all <code>-- upgrade</code> sections</li> <li>Combines rollback SQL: Merges all <code>-- rollback</code> sections</li> <li>Creates new migration: Generates a consolidated migration file</li> <li>Updates tracking: Records new migration in database</li> </ol>"},{"location":"commands/squash/#before-squashing","title":"Before Squashing","text":"<pre><code>Migrations:\n\u251c\u2500\u2500 V20240215_143000__create_users.sql\n\u251c\u2500\u2500 V20240215_143001__add_username.sql\n\u251c\u2500\u2500 V20240215_143002__add_email.sql\n\u2514\u2500\u2500 V20240215_143003__add_password.sql\n</code></pre>"},{"location":"commands/squash/#after-squashing","title":"After Squashing","text":"<pre><code>Migrations:\n\u2514\u2500\u2500 V20240215_143000__initial_schema.sql\n</code></pre>"},{"location":"commands/squash/#use-cases","title":"Use Cases","text":""},{"location":"commands/squash/#cleanup-migration-history","title":"Cleanup Migration History","text":"<p>Reduce number of migration files:</p> <ul> <li>Many small migrations \u2192 fewer large ones</li> <li>Easier to review</li> <li>Faster migration execution</li> </ul>"},{"location":"commands/squash/#performance-optimization","title":"Performance Optimization","text":"<p>Fewer migrations = fewer files to parse and execute.</p>"},{"location":"commands/squash/#requirements","title":"Requirements","text":"<ol> <li>All migrations applied: No pending migrations</li> <li>No concurrent processes: Database not in active use</li> <li>Backup recommended: Before squashing in production</li> </ol>"},{"location":"commands/squash/#important-considerations","title":"Important Considerations","text":""},{"location":"commands/squash/#downtime","title":"Downtime","text":"<p>Squashing requires exclusive database access: - Lock is acquired - All migrations are reapplied - Can cause downtime in production</p>"},{"location":"commands/squash/#testing-required","title":"Testing Required","text":"<p>Always test squashing: 1. On development database 2. On staging environment 3. Before production</p>"},{"location":"commands/squash/#rollback-changes","title":"Rollback Changes","text":"<p>After squashing: - Old migration files are removed - New consolidated migration replaces them - Cannot easily rollback to old state</p>"},{"location":"commands/squash/#best-practices","title":"Best Practices","text":""},{"location":"commands/squash/#when-to-squash","title":"When to Squash","text":"<ul> <li>After many small migrations (10+)</li> <li>Before major releases</li> <li>During maintenance windows</li> <li>Never in production during peak hours</li> </ul>"},{"location":"commands/squash/#when-not-to-squash","title":"When NOT to Squash","text":"<ul> <li>During active development</li> <li>Before code freeze</li> <li>If migrations are frequently changing</li> <li>In production without testing</li> </ul>"},{"location":"commands/squash/#backup-first","title":"Backup First","text":"<pre><code># Backup database\npg_dump $DATABASE_URL &gt; backup_before_squash.sql\n\n# Backup migrations\ncp -r migrations migrations_backup\n</code></pre>"},{"location":"commands/squash/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/squash/#pending-migrations-exist","title":"Pending Migrations Exist","text":"<pre><code>Cannot squash: 5 migrations are pending.\nPlease run 'dbwarden migrate' first.\n</code></pre> <p>Apply all migrations before squashing.</p>"},{"location":"commands/squash/#migration-table-doesnt-exist","title":"Migration Table Doesn't Exist","text":"<pre><code>No migrations found. Nothing to squash.\n</code></pre> <p>Apply at least one migration.</p>"},{"location":"commands/squash/#alternative-manual-squashing","title":"Alternative: Manual Squashing","text":"<p>For more control, manually combine migrations:</p> <pre><code># 1. Create new migration\ndbwarden new \"consolidate user migrations\"\n\n# 2. Edit the file, combining SQL from:\n# - V20240215_143000__create_users.sql\n# - V20240215_143001__add_username.sql\n# - V20240215_143002__add_email.sql\n</code></pre>"},{"location":"commands/squash/#see-also","title":"See Also","text":"<ul> <li>new: Create manual migrations</li> <li>migrate: Apply migrations</li> <li>rollback: Revert migrations</li> </ul>"},{"location":"commands/status/","title":"status Command","text":"<p>Display the current migration status including applied and pending migrations.</p>"},{"location":"commands/status/#description","title":"Description","text":"<p>The <code>status</code> command shows a comprehensive view of your migration state, comparing migration files in the local directory with what has been applied to the database.</p>"},{"location":"commands/status/#usage","title":"Usage","text":"<pre><code>dbwarden status\n</code></pre>"},{"location":"commands/status/#examples","title":"Examples","text":""},{"location":"commands/status/#basic-usage","title":"Basic Usage","text":"<pre><code>Migration Status\n================\n\u2713 Applied   | V20240215_143000__create_users\n\u2713 Applied   | V20240215_143001__create_posts\n\u2713 Applied   | V20240215_143002__add_comments\nPending     | V20240215_143003__add_tags\n\nApplied: 3\nPending: 1\nTotal: 4\n</code></pre>"},{"location":"commands/status/#no-migrations-directory","title":"No Migrations Directory","text":"<pre><code>migrations directory not found. Run 'dbwarden init' first.\n</code></pre>"},{"location":"commands/status/#no-migrations-applied-yet","title":"No Migrations Applied Yet","text":"<pre><code>Migration Status\n================\nStatus    | Version         | Filename\nPending   | 20240215_143000 | V20240215_143000__initial.sql\n\nApplied: 0\nPending: 1\nTotal: 1\n</code></pre>"},{"location":"commands/status/#output-columns","title":"Output Columns","text":"Column Description Status Migration state (Applied/Pending) Version Migration version identifier Filename Migration file name"},{"location":"commands/status/#status-types","title":"Status Types","text":"Status Icon Meaning Applied \u2713 Successfully applied to database Pending (none) Not yet applied to database"},{"location":"commands/status/#use-cases","title":"Use Cases","text":""},{"location":"commands/status/#before-applying-migrations","title":"Before Applying Migrations","text":"<p>Check what's pending before deployment:</p> <pre><code>dbwarden status\n# Review pending migrations\ndbwarden migrate\n</code></pre>"},{"location":"commands/status/#after-deployment","title":"After Deployment","text":"<p>Verify all migrations were applied:</p> <pre><code>dbwarden status\n# Confirm Applied count matches expectations\n</code></pre>"},{"location":"commands/status/#debugging-issues","title":"Debugging Issues","text":"<p>When schema doesn't match expectations:</p> <pre><code>dbwarden status\n# Check which migrations are pending\ndbwarden migrate\n# Apply any missing migrations\n</code></pre>"},{"location":"commands/status/#comparing-with-history","title":"Comparing with History","text":"Command Shows Source <code>status</code> Applied + Pending Local files + Database <code>history</code> Applied only Database only"},{"location":"commands/status/#summary-statistics","title":"Summary Statistics","text":"<p>The status command provides counts:</p> <pre><code>Applied: 3     # Migrations in database\nPending: 1     # Migrations not yet applied\nTotal: 4       # All migration files\n</code></pre>"},{"location":"commands/status/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/status/#pending-migrations-exist","title":"Pending Migrations Exist","text":"<p>If pending migrations are shown:</p> <pre><code>dbwarden migrate --verbose\n</code></pre>"},{"location":"commands/status/#applied-count-doesnt-match","title":"Applied Count Doesn't Match","text":"<p>If applied count is unexpected:</p> <ol> <li>Check <code>dbwarden history</code> for applied migrations</li> <li>Verify database connection in <code>.env</code></li> <li>Check for migrations in wrong location</li> </ol>"},{"location":"commands/status/#no-migrations-directory_1","title":"No Migrations Directory","text":"<p>Run initialization:</p> <pre><code>dbwarden init\n</code></pre>"},{"location":"commands/status/#workflow-integration","title":"Workflow Integration","text":""},{"location":"commands/status/#development-workflow","title":"Development Workflow","text":"<pre><code># 1. Check current state\ndbwarden status\n\n# 2. Make model changes\n# ... edit models ...\n\n# 3. Generate migration\ndbwarden make-migrations \"describe changes\"\n\n# 4. Check status\ndbwarden status\n\n# 5. Apply migration\ndbwarden migrate\n</code></pre>"},{"location":"commands/status/#deployment-workflow","title":"Deployment Workflow","text":"<pre><code># 1. Check status before deployment\ndbwarden status\n\n# 2. Apply pending migrations\ndbwarden migrate --verbose\n\n# 3. Verify deployment\ndbwarden status\n</code></pre>"},{"location":"commands/status/#best-practices","title":"Best Practices","text":"<ol> <li>Always check status before applying migrations</li> <li>Review pending migrations in detail</li> <li>Compare counts before and after operations</li> <li>Document discrepancies if any found</li> </ol>"},{"location":"commands/status/#see-also","title":"See Also","text":"<ul> <li>history: Show applied migrations only</li> <li>migrate: Apply pending migrations</li> <li>make-migrations: Generate new migrations</li> </ul>"},{"location":"commands/version/","title":"version Command","text":"<p>Display DBWarden version and compatibility information.</p>"},{"location":"commands/version/#usage","title":"Usage","text":"<pre><code>dbwarden version\n</code></pre>"},{"location":"commands/version/#examples","title":"Examples","text":"<pre><code>DBWarden version: 1.0.0\nPython version: 3.12.0\nSQLAlchemy version: 2.0.10\n</code></pre>"},{"location":"commands/version/#what-it-shows","title":"What It Shows","text":"Component Version DBWarden Current version Python Python interpreter version SQLAlchemy SQLAlchemy library version"},{"location":"commands/version/#use-cases","title":"Use Cases","text":""},{"location":"commands/version/#bug-reports","title":"Bug Reports","text":"<p>Include version info in bug reports:</p> <pre><code>dbwarden version\n# Include in GitHub issue\n</code></pre>"},{"location":"commands/version/#compatibility-check","title":"Compatibility Check","text":"<p>Verify compatibility:</p> <pre><code>dbwarden version\n# Check requirements match\n</code></pre>"},{"location":"commands/version/#upgrade-verification","title":"Upgrade Verification","text":"<p>After upgrading:</p> <pre><code>dbwarden --version\n# Should show new version\n</code></pre>"},{"location":"commands/version/#versioning","title":"Versioning","text":"<p>DBWarden uses Semantic Versioning:</p> <ul> <li>MAJOR: Breaking changes</li> <li>MINOR: New features (backward compatible)</li> <li>PATCH: Bug fixes (backward compatible)</li> </ul>"},{"location":"commands/version/#see-also","title":"See Also","text":"<ul> <li>Installation: Installation requirements</li> </ul>"}]}